{
  "name": "tm-tdd",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "main": "index.js",
  "engines": { "node": ">=20 <21" },
  "scripts": {
    "test": "vitest",
    "test:watch": "vitest --watch",

    "build:common": "esbuild src/common/index.js --bundle --format=iife --global-name=QTCommon --outfile=../wwwroot/dist/qt-common.core.js",
    "build:common:watch": "npm run build:common -- --watch",
    "build:qt30": "esbuild src/qt30/init.js --bundle --format=iife --global-name=QT30Core --outfile=../wwwroot/dist/qt30.core.js",
    "build:qt30:watch": "npm run build:qt30 -- --watch",

    "verify:release": "node -e \"const fs=require('fs');const s=fs.readFileSync('../release/QT10.user.js','utf8');if(/localhost\\/dist\\/qt-common\\.core\\.js|@require\\s+http:\\/\\/localhost:\\d+\\/dist\\//i.test(s)){console.error('❌ Release contains dev-only @require');process.exit(1)}console.log('✅ Release clean');\"",
    "pre:release": "vitest run",

    "build:qt10:dev": "esbuild src/qt10/main.js --bundle --format=iife --define:DEV=true --outfile=../wwwroot/QT10.dev.body.js && powershell -NoProfile -Command \"$ErrorActionPreference='Stop'; $out='..\\wwwroot\\QT10.dev.user.js'; $tmp='..\\wwwroot\\QT10.dev.user.tmp'; Get-Content .\\banners\\QT10.dev.header.js, ..\\wwwroot\\QT10.dev.body.js | Set-Content -Encoding utf8NoBOM $tmp; Move-Item -Force $tmp $out; Remove-Item ..\\wwwroot\\QT10.dev.body.js\"",

    "release:qt10": "esbuild src/qt10/main.js --bundle --format=iife --minify --define:DEV=false --banner:js=\"// ==UserScript==\\n// @name         QT10 → Get Catalog by Customer\\n// @namespace    https://github.com/AlphaGeek509/plex-tampermonkey-scripts\\n// @version      3.5.177\\n// @description  Production build (no DEV code)\\n// @match        https://*.plex.com/*\\n// @match        https://*.on.plex.com/*\\n// @require      http://localhost:5000/lt-plex-tm-utils.user.js\\n// @require      http://localhost:5000/lt-plex-auth.user.js\\n// @grant        GM_registerMenuCommand\\n// @grant        GM_getValue\\n// @grant        GM_setValue\\n// @grant        GM_xmlHttpRequest\\n// @grant        unsafeWindow\\n// @connect      *.plex.com\\n// @run-at       document-idle\\n// @noframes\\n// ==/UserScript==\\n\" --outfile=../release/QT10.user.js",

    "release:qt10:prep": "powershell -NoProfile -Command \"New-Item -ItemType Directory -Force ..\\release | Out-Null; Copy-Item ..\\wwwroot\\QT10-GetCatalogByCustomer.user.js ..\\release\\QT10.user.js -Force\"",
    "release:qt10:major": "npm run pre:release && npm run release:qt10:prep && node ..\\build-plus.js --major --files \"..\\release\\QT10.user.js\" && npm run verify:release",
    "release:qt10:minor": "npm run pre:release && npm run release:qt10:prep && node ..\\build-plus.js --minor --files \"..\\release\\QT10.user.js\" && npm run verify:release",
    "release:qt10:patch": "npm run pre:release && npm run release:qt10 && node ..\\build-plus.js --patch --files \"..\\release\\QT10.user.js\" && npm run verify:release"
  },
  "devDependencies": {
    "@testing-library/dom": "^10.4.1",
    "esbuild": "^0.25.9",
    "jsdom": "^26.1.0",
    "knockout": "^3.5.1",
    "vitest": "^3.2.4"
  }
}
