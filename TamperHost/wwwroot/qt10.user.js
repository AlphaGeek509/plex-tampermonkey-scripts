// ==UserScript==
// @name        QT10_DEV
// @namespace   https://github.com/AlphaGeek509/plex-tampermonkey-scripts
// @version     3.8.37
// @description DEV-only build; includes user-start gate
// @match       https://lyntron.on.plex.com/SalesAndCRM*
// @match       https://lyntron.on.plex.com/SalesAndCrm*
// @match       https://lyntron.test.on.plex.com/SalesAndCRM*
// @match       https://lyntron.test.on.plex.com/SalesAndCrm*
// @require      http://localhost:5000/lt-plex-tm-utils.user.js?v=3.8.37-1758668539276
// @require      http://localhost:5000/lt-plex-auth.user.js?v=3.8.37-1758668539276
// @require      http://localhost:5000/lt-ui-hub.js?v=3.8.37-1758668539276
// @require      http://localhost:5000/lt-data-core.user.js?v=3.8.37-1758668539276
// @require      http://localhost:5000/lt-core.user.js?v=3.8.37-1758668539276
// @resource     THEME_CSS http://localhost:5000/theme.css
// @grant       GM_registerMenuCommand
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_xmlhttpRequest
// @grant       unsafeWindow
// @connect     *.plex.com
// @run-at      document-start
// @noframes
// @grant        GM_addStyle
// @grant        GM_getResourceText
// @updateURL   http://localhost:5000/qt10.user.js
// @downloadURL http://localhost:5000/qt10.user.js
// ==/UserScript==

(() => {
  // src/quote-tracking/qt10-customerCatalogGet/qt10.index.js
  (async function() {
    "use strict";
    const DEV = true ? true : !!(typeof globalThis !== "undefined" && globalThis.__TM_DEV__);
    const CFG = {
      NAME: "QT10",
      ROUTES: [/^\/SalesAndCRM\/QuoteWizard(?:\/|$)/i],
      // KO-bound anchor we wait for to ensure VM is ready
      ANCHOR: '[data-val-property-name="CustomerNo"]',
      // Data sources
      DS_CATALOG_BY_CUSTOMER: 319,
      DS_CATALOG_CODE_BY_KEY: 22696,
      // If true, don’t pre-fire on page load; wait for a real user edit
      GATE_USER_EDIT: true
    };
    const IS_TEST_ENV = /test\.on\.plex\.com$/i.test(location.hostname);
    try {
      TMUtils.setDebug?.(IS_TEST_ENV);
    } catch {
    }
    const L = TMUtils.getLogger?.(CFG.NAME);
    const dlog = (...a) => {
      if (IS_TEST_ENV) L?.log?.(...a);
    };
    const derror = (...a) => {
      if (IS_TEST_ENV) L?.error?.(...a);
    };
    if (!CFG.ROUTES.some((rx) => rx.test(location.pathname))) return;
    window.__LT_HUB_MOUNT = "nav";
    await window.ensureLTHub?.({ mount: "nav" });
    lt.core.hub.notify("Ready", "info", { sticky: true });
    function getTabScopeId(ns = "QT") {
      try {
        const NEW = `lt:${ns}:__scopeId`;
        const OLD = `lt:${ns}:scopeId`;
        let v = sessionStorage.getItem(NEW) || sessionStorage.getItem(OLD);
        if (!v) {
          v = String(Math.floor(Math.random() * 2147483647));
        }
        try {
          sessionStorage.setItem(NEW, v);
          sessionStorage.removeItem(OLD);
        } catch {
        }
        return Number(v);
      } catch {
        return Math.floor(Math.random() * 2147483647);
      }
    }
    const SCOPE_DRAFT = "draft";
    let QT = null;
    const QTF = lt.core?.data?.makeFlatScopedRepo ? lt.core.data.makeFlatScopedRepo({ ns: "QT", entity: "quote", legacyEntity: "QuoteHeader" }) : null;
    let repoDraft = null;
    async function ensureDraftRepo() {
      if (repoDraft) return repoDraft;
      const coreRepo = await lt?.core?.qt?.useDraftRepo?.();
      if (coreRepo) {
        repoDraft = coreRepo;
        return repoDraft;
      }
      if (!QTF) return null;
      const { repo } = QTF.use(getTabScopeId("QT"));
      repoDraft = repo;
      await repoDraft.ensureFromLegacyIfMissing?.();
      return repoDraft;
    }
    const withFreshAuth = (fn) => {
      const impl = lt?.core?.auth?.withFreshAuth;
      return typeof impl === "function" ? impl(fn) : fn();
    };
    async function ensureAuthOrToast() {
      try {
        if (await lt.core.auth.getKey()) return true;
      } catch {
      }
      lt.core.hub.notify("Auth looks stale. Retrying\u2026", "warn", { toast: true });
      return false;
    }
    async function anchorAppears(sel, { timeoutMs = 1e4, pollMs = 150 } = {}) {
      const t0 = Date.now();
      while (Date.now() - t0 < timeoutMs) {
        if (document.querySelector(sel)) return true;
        await (TMUtils.sleep?.(pollMs) || new Promise((r) => setTimeout(r, pollMs)));
      }
      return !!document.querySelector(sel);
    }
    let booted = false, booting = false, disposeWatcher = null, unsubscribeUrl = null;
    async function maybeBoot() {
      if (booted || booting) return;
      booting = true;
      try {
        if (!CFG.ROUTES.some((rx) => rx.test(location.pathname))) return;
        if (!await anchorAppears(CFG.ANCHOR)) return;
        if (!await ensureAuthOrToast()) return;
        const { viewModel } = await TMUtils.waitForModelAsync(CFG.ANCHOR, {
          pollMs: 200,
          timeoutMs: 8e3,
          logger: IS_TEST_ENV ? L : null
        });
        if (!viewModel) return;
        let lastCustomerNo = null;
        disposeWatcher = TMUtils.watchBySelector({
          selector: CFG.ANCHOR,
          // If user-gated, don’t fire an initial read; wait for real input
          initial: !CFG.GATE_USER_EDIT ? true : false,
          fireOn: "blur",
          settleMs: 350,
          logger: IS_TEST_ENV ? L : null,
          onChange: async () => {
            const customerNo = TMUtils.getObsValue(viewModel, "CustomerNo", { first: true, trim: true });
            if (!customerNo || customerNo === lastCustomerNo) return;
            lastCustomerNo = customerNo;
            await applyCatalogFor(customerNo, viewModel);
          }
        });
        booted = true;
      } catch (e) {
        booted = false;
        derror(`${CFG.NAME} init failed:`, e);
      } finally {
        booting = false;
      }
    }
    async function applyCatalogFor(customerNo, vm) {
      if (!customerNo) return;
      const task = lt.core.hub.beginTask("Linking catalog\u2026", "info");
      try {
        const rows1 = await withFreshAuth(
          () => lt.core.plex.dsRows(CFG.DS_CATALOG_BY_CUSTOMER, { Customer_No: customerNo })
        );
        const row1 = Array.isArray(rows1) ? rows1[0] : null;
        const catalogKey = row1?.Catalog_Key || 0;
        if (!catalogKey) {
          task.error("No catalog found for this customer.");
          return;
        }
        const rows2 = await withFreshAuth(
          () => lt.core.plex.dsRows(CFG.DS_CATALOG_CODE_BY_KEY, { Catalog_Key: catalogKey })
        );
        const catalogCode = (Array.isArray(rows2) ? rows2.map((r) => r?.Catalog_Code).find(Boolean) : null) || "";
        TMUtils.setObsValue(vm, "CatalogKey", catalogKey);
        TMUtils.setObsValue(vm, "CatalogCode", catalogCode);
        const repo = await ensureDraftRepo();
        if (repo) {
          persistDraftHeaderWithRetry({
            Customer_No: String(customerNo),
            Catalog_Key: Number(catalogKey),
            Catalog_Code: String(catalogCode || ""),
            Catalog_Fetched_At: Date.now(),
            Updated_At: Date.now()
          });
        }
        const codeTrimmed = typeof catalogCode === "string" ? catalogCode.trim() : "";
        const display = codeTrimmed || String(catalogKey ?? "");
        const msg = codeTrimmed ? `Linked: ${codeTrimmed} (key ${catalogKey})` : `Linked: key ${catalogKey}`;
        task.success(msg);
        lt.core.hub.notify(msg, "success", { ms: 3e3 });
      } catch (err) {
        task.error("No catalog found for this customer.");
        derror(err);
      }
    }
    const __QT10_PERSIST = { queue: null, timer: null };
    async function persistDraftHeaderWithRetry(patch, maxTries = 120, intervalMs = 250) {
      const promoteNow = (mode) => {
        try {
          const ctx = lt?.core?.qt?.getQuoteContext?.();
          const qk = Number(ctx?.quoteKey || 0);
          if (qk > 0) lt.core.qt.promoteDraftToQuote?.({ qk, strategy: mode });
        } catch {
        }
      };
      try {
        const repo = await ensureDraftRepo();
        if (repo) {
          await repo.patchHeader(patch);
          promoteNow("once");
          return true;
        }
      } catch (e) {
        console.debug("QT10: repo not ready now, will retry", e);
      }
      __QT10_PERSIST.queue = { ...__QT10_PERSIST.queue || {}, ...patch };
      if (__QT10_PERSIST.timer) return false;
      let triesLeft = maxTries;
      __QT10_PERSIST.timer = setInterval(async () => {
        try {
          const repoLater = await ensureDraftRepo();
          if (!repoLater) {
            if (--triesLeft <= 0) {
              clearInterval(__QT10_PERSIST.timer);
              __QT10_PERSIST.timer = null;
              console.warn("QT10: repo never became ready; gave up after retries");
            }
            return;
          }
          const payload = __QT10_PERSIST.queue;
          __QT10_PERSIST.queue = null;
          clearInterval(__QT10_PERSIST.timer);
          __QT10_PERSIST.timer = null;
          await repoLater.patchHeader(payload);
          console.debug("QT10: draft persisted after retry", payload);
          promoteNow("retry");
        } catch (err) {
          console.warn("QT10: retry persist error", err);
        }
      }, intervalMs);
      return false;
    }
    unsubscribeUrl = TMUtils.onUrlChange?.(() => {
      if (!CFG.ROUTES.some((rx) => rx.test(location.pathname))) {
        try {
          disposeWatcher?.();
        } catch {
        }
        disposeWatcher = null;
        booted = false;
        booting = false;
        return;
      }
      setTimeout(maybeBoot, 0);
    });
    setTimeout(maybeBoot, 0);
    const W = typeof unsafeWindow !== "undefined" ? unsafeWindow : window;
    W.QT10_debugDraft = async () => {
      const repo = await ensureDraftRepo();
      const snap = await repo?.get();
      console.debug("QT10 draft \u2192", snap);
      return snap;
    };
    W.QT10_forceDraft = async (patch = {}) => {
      const repo = await ensureDraftRepo();
      if (!repo) {
        console.warn("QT10: repo not ready");
        return null;
      }
      await repo.patchHeader({
        Customer_No: "TEST",
        Catalog_Key: 99999,
        Catalog_Code: "TestCatalog",
        Updated_At: Date.now(),
        ...patch
      });
      return await repo.get();
    };
    W.QT10_checkDC = () => !!lt?.core?.data?.makeFlatScopedRepo;
    W.QT10_dcStatus = () => {
      const hasFactory = !!lt?.core?.data?.makeFlatScopedRepo;
      return { hasCore: hasFactory, hasFactory };
    };
  })();
})();
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vdG0tc2NyaXB0cy9zcmMvcXVvdGUtdHJhY2tpbmcvcXQxMC1jdXN0b21lckNhdGFsb2dHZXQvcXQxMC5pbmRleC5qcyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLy8gc3JjL3F1b3RlLXRyYWNraW5nL3F0MTAtY3VzdG9tZXJDYXRhbG9nR2V0L3F0MTAuaW5kZXguanNcbi8vIERyb3AtaW4gbW9kdWxlIChidW5kbGVkIGJ5IGJ1aWxkLXBsdXMvZXNidWlsZCkuIE5vIFRNIGhlYWRlciBoZXJlOyB5b3VyIGJ1aWxkIGluamVjdHMgaXQuXG4vLyBSZXN0b3JlcyBidXNpbmVzcyBsb2dpYyBmcm9tIHF0MTAuYmFja3VwLmpzIGFuZCBmaXhlcyBSZXBvQmFzZSBjbGFzcyBpbnZvY2F0aW9uLlxuXG4oYXN5bmMgZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLy8gPT09PT0gRGV2IGZsYWcgKGJ1aWxkLXRpbWUgd2l0aCBydW50aW1lIGZhbGxiYWNrKSA9PT09PVxuICAgIGNvbnN0IERFViA9ICh0eXBlb2YgX19CVUlMRF9ERVZfXyAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgID8gX19CVUlMRF9ERVZfX1xuICAgICAgICA6ICEhKHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyAmJiBnbG9iYWxUaGlzLl9fVE1fREVWX18pO1xuXG4gICAgLy8gPT09PT0gQ29uZmlnID09PT09XG4gICAgY29uc3QgQ0ZHID0ge1xuICAgICAgICBOQU1FOiAnUVQxMCcsXG4gICAgICAgIFJPVVRFUzogWy9eXFwvU2FsZXNBbmRDUk1cXC9RdW90ZVdpemFyZCg/OlxcL3wkKS9pXSxcbiAgICAgICAgLy8gS08tYm91bmQgYW5jaG9yIHdlIHdhaXQgZm9yIHRvIGVuc3VyZSBWTSBpcyByZWFkeVxuICAgICAgICBBTkNIT1I6ICdbZGF0YS12YWwtcHJvcGVydHktbmFtZT1cIkN1c3RvbWVyTm9cIl0nLFxuICAgICAgICAvLyBEYXRhIHNvdXJjZXNcbiAgICAgICAgRFNfQ0FUQUxPR19CWV9DVVNUT01FUjogMzE5LFxuICAgICAgICBEU19DQVRBTE9HX0NPREVfQllfS0VZOiAyMjY5NixcbiAgICAgICAgLy8gSWYgdHJ1ZSwgZG9uXHUyMDE5dCBwcmUtZmlyZSBvbiBwYWdlIGxvYWQ7IHdhaXQgZm9yIGEgcmVhbCB1c2VyIGVkaXRcbiAgICAgICAgR0FURV9VU0VSX0VESVQ6IHRydWUsXG4gICAgfTtcblxuICAgIC8vID09PT09IERlYnVnIC8gTG9nZ2VyIC8gREVWIHRvYXN0ID09PT09XG4gICAgY29uc3QgSVNfVEVTVF9FTlYgPSAvdGVzdFxcLm9uXFwucGxleFxcLmNvbSQvaS50ZXN0KGxvY2F0aW9uLmhvc3RuYW1lKTtcbiAgICB0cnkgeyBUTVV0aWxzLnNldERlYnVnPy4oSVNfVEVTVF9FTlYpOyB9IGNhdGNoIHsgfVxuICAgIGNvbnN0IEwgPSBUTVV0aWxzLmdldExvZ2dlcj8uKENGRy5OQU1FKTtcbiAgICBjb25zdCBkbG9nID0gKC4uLmEpID0+IHsgaWYgKElTX1RFU1RfRU5WKSBMPy5sb2c/LiguLi5hKTsgfTtcbiAgICBjb25zdCBkZXJyb3IgPSAoLi4uYSkgPT4geyBpZiAoSVNfVEVTVF9FTlYpIEw/LmVycm9yPy4oLi4uYSk7IH07XG5cbiAgICAvLyA9PT09PSBSb3V0ZSBhbGxvd2xpc3QgPT09PT1cbiAgICAvLyBhdm9pZCBkZXBlbmRpbmcgb24gVE1VdGlscyB0aW1pbmc7IHVzZSByZWdleCBvbiBwYXRobmFtZVxuICAgIGlmICghQ0ZHLlJPVVRFUy5zb21lKHJ4ID0+IHJ4LnRlc3QobG9jYXRpb24ucGF0aG5hbWUpKSkgcmV0dXJuO1xuXG4gICAgd2luZG93Ll9fTFRfSFVCX01PVU5UID0gXCJuYXZcIjtcbiAgICBhd2FpdCB3aW5kb3cuZW5zdXJlTFRIdWI/Lih7IG1vdW50OiBcIm5hdlwiIH0pO1xuXG4gICAgbHQuY29yZS5odWIubm90aWZ5KFwiUmVhZHlcIiwgXCJpbmZvXCIsIHsgc3RpY2t5OiB0cnVlIH0pO1xuXG4gICAgZnVuY3Rpb24gZ2V0VGFiU2NvcGVJZChucyA9ICdRVCcpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IE5FVyA9IGBsdDoke25zfTpfX3Njb3BlSWRgO1xuICAgICAgICAgICAgY29uc3QgT0xEID0gYGx0OiR7bnN9OnNjb3BlSWRgOyAvLyBsZWdhY3lcbiAgICAgICAgICAgIGxldCB2ID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShORVcpIHx8IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oT0xEKTtcbiAgICAgICAgICAgIGlmICghdikge1xuICAgICAgICAgICAgICAgIHYgPSBTdHJpbmcoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMl8xNDdfNDgzXzY0NykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHsgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShORVcsIHYpOyBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKE9MRCk7IH0gY2F0Y2ggeyB9XG4gICAgICAgICAgICByZXR1cm4gTnVtYmVyKHYpO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyXzE0N180ODNfNjQ3KTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLy8gPT09PT0gRGF0YSB2aWEgbHQuY29yZS5kYXRhIChmbGF0IHtoZWFkZXIsIGxpbmVzfSkgPT09PT1cbiAgICBjb25zdCBTQ09QRV9EUkFGVCA9ICdkcmFmdCc7XG4gICAgbGV0IFFUID0gbnVsbDtcblxuICAgIC8vIEZsYXQgcmVwbyBmYWN0b3J5IChubyBwb2xsaW5nIHJlcXVpcmVkIG5vdyB0aGF0IGx0LWRhdGEtY29yZSBpbnN0YWxscyBhdCBkb2Mtc3RhcnQpXG4gICAgY29uc3QgUVRGID0gbHQuY29yZT8uZGF0YT8ubWFrZUZsYXRTY29wZWRSZXBvXG4gICAgICAgID8gbHQuY29yZS5kYXRhLm1ha2VGbGF0U2NvcGVkUmVwbyh7IG5zOiBcIlFUXCIsIGVudGl0eTogXCJxdW90ZVwiLCBsZWdhY3lFbnRpdHk6IFwiUXVvdGVIZWFkZXJcIiB9KVxuICAgICAgICA6IG51bGw7XG5cbiAgICBsZXQgcmVwb0RyYWZ0ID0gbnVsbDtcbiAgICBhc3luYyBmdW5jdGlvbiBlbnN1cmVEcmFmdFJlcG8oKSB7XG4gICAgICAgIGlmIChyZXBvRHJhZnQpIHJldHVybiByZXBvRHJhZnQ7XG5cbiAgICAgICAgLy8gUHJlZmVyIHRoZSBjZW50cmFsaXplZCwgdmVyc2lvbmVkIHBhdGggaW4gbHQtY29yZVxuICAgICAgICBjb25zdCBjb3JlUmVwbyA9IGF3YWl0IGx0Py5jb3JlPy5xdD8udXNlRHJhZnRSZXBvPy4oKTtcbiAgICAgICAgaWYgKGNvcmVSZXBvKSB7XG4gICAgICAgICAgICByZXBvRHJhZnQgPSBjb3JlUmVwbztcbiAgICAgICAgICAgIHJldHVybiByZXBvRHJhZnQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGYWxsYmFjayB0byBsb2NhbCBmYWN0b3J5IGlmIGx0LWNvcmUgaXMgbm90IHJlYWR5IHlldFxuICAgICAgICBpZiAoIVFURikgcmV0dXJuIG51bGw7XG4gICAgICAgIGNvbnN0IHsgcmVwbyB9ID0gUVRGLnVzZShnZXRUYWJTY29wZUlkKFwiUVRcIikpO1xuICAgICAgICByZXBvRHJhZnQgPSByZXBvO1xuICAgICAgICBhd2FpdCByZXBvRHJhZnQuZW5zdXJlRnJvbUxlZ2FjeUlmTWlzc2luZz8uKCk7XG4gICAgICAgIHJldHVybiByZXBvRHJhZnQ7XG4gICAgfVxuXG5cbiAgICAvLyBTYWZlIGRlbGVnYXRpbmcgd3JhcHBlcjogdXNlIGx0LmNvcmUuYXV0aC53aXRoRnJlc2hBdXRoIHdoZW4gYXZhaWxhYmxlLFxuICAgIC8vIG90aGVyd2lzZSBqdXN0IHJ1biB0aGUgY2FsbGJhY2sgb25jZSAoYmVzdC1lZmZvcnQgZmFsbGJhY2spLlxuICAgIGNvbnN0IHdpdGhGcmVzaEF1dGggPSAoZm4pID0+IHtcbiAgICAgICAgY29uc3QgaW1wbCA9IGx0Py5jb3JlPy5hdXRoPy53aXRoRnJlc2hBdXRoO1xuICAgICAgICByZXR1cm4gdHlwZW9mIGltcGwgPT09ICdmdW5jdGlvbicgPyBpbXBsKGZuKSA6IGZuKCk7XG4gICAgfTtcblxuXG4gICAgYXN5bmMgZnVuY3Rpb24gZW5zdXJlQXV0aE9yVG9hc3QoKSB7XG4gICAgICAgIHRyeSB7IGlmIChhd2FpdCBsdC5jb3JlLmF1dGguZ2V0S2V5KCkpIHJldHVybiB0cnVlOyB9IGNhdGNoIHsgfVxuICAgICAgICBsdC5jb3JlLmh1Yi5ub3RpZnkoJ0F1dGggbG9va3Mgc3RhbGUuIFJldHJ5aW5nXHUyMDI2JywgJ3dhcm4nLCB7IHRvYXN0OiB0cnVlIH0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gPT09PT0gRE9NL0tPIHJlYWRpbmVzcyA9PT09PVxuICAgIGFzeW5jIGZ1bmN0aW9uIGFuY2hvckFwcGVhcnMoc2VsLCB7IHRpbWVvdXRNcyA9IDEwMDAwLCBwb2xsTXMgPSAxNTAgfSA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHQwID0gRGF0ZS5ub3coKTtcbiAgICAgICAgd2hpbGUgKERhdGUubm93KCkgLSB0MCA8IHRpbWVvdXRNcykge1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsKSkgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICBhd2FpdCAoVE1VdGlscy5zbGVlcD8uKHBvbGxNcykgfHwgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIHBvbGxNcykpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gISFkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbCk7XG4gICAgfVxuXG4gICAgLy8gPT09PT0gQm9vdHN0cmFwIChTUEEtc2FmZSkgPT09PT1cbiAgICBsZXQgYm9vdGVkID0gZmFsc2UsIGJvb3RpbmcgPSBmYWxzZSwgZGlzcG9zZVdhdGNoZXIgPSBudWxsLCB1bnN1YnNjcmliZVVybCA9IG51bGw7XG5cbiAgICBhc3luYyBmdW5jdGlvbiBtYXliZUJvb3QoKSB7XG4gICAgICAgIGlmIChib290ZWQgfHwgYm9vdGluZykgcmV0dXJuO1xuICAgICAgICBib290aW5nID0gdHJ1ZTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghQ0ZHLlJPVVRFUy5zb21lKHJ4ID0+IHJ4LnRlc3QobG9jYXRpb24ucGF0aG5hbWUpKSkgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKCEoYXdhaXQgYW5jaG9yQXBwZWFycyhDRkcuQU5DSE9SKSkpIHJldHVybjtcbiAgICAgICAgICAgIGlmICghKGF3YWl0IGVuc3VyZUF1dGhPclRvYXN0KCkpKSByZXR1cm47XG5cbiAgICAgICAgICAgIGNvbnN0IHsgdmlld01vZGVsIH0gPSBhd2FpdCBUTVV0aWxzLndhaXRGb3JNb2RlbEFzeW5jKENGRy5BTkNIT1IsIHtcbiAgICAgICAgICAgICAgICBwb2xsTXM6IDIwMCwgdGltZW91dE1zOiA4MDAwLCBsb2dnZXI6IElTX1RFU1RfRU5WID8gTCA6IG51bGxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCF2aWV3TW9kZWwpIHJldHVybjtcblxuICAgICAgICAgICAgLy8gV2F0Y2ggQ3VzdG9tZXJObyBcdTIxOTIgbG9vayB1cCBjYXRhbG9nIFx1MjE5MiB3cml0ZSB0byBEUkFGVCBzY29wZVxuICAgICAgICAgICAgbGV0IGxhc3RDdXN0b21lck5vID0gbnVsbDtcbiAgICAgICAgICAgIGRpc3Bvc2VXYXRjaGVyID0gVE1VdGlscy53YXRjaEJ5U2VsZWN0b3Ioe1xuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiBDRkcuQU5DSE9SLFxuICAgICAgICAgICAgICAgIC8vIElmIHVzZXItZ2F0ZWQsIGRvblx1MjAxOXQgZmlyZSBhbiBpbml0aWFsIHJlYWQ7IHdhaXQgZm9yIHJlYWwgaW5wdXRcbiAgICAgICAgICAgICAgICBpbml0aWFsOiAhQ0ZHLkdBVEVfVVNFUl9FRElUID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGZpcmVPbjogJ2JsdXInLFxuICAgICAgICAgICAgICAgIHNldHRsZU1zOiAzNTAsXG4gICAgICAgICAgICAgICAgbG9nZ2VyOiBJU19URVNUX0VOViA/IEwgOiBudWxsLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1c3RvbWVyTm8gPSBUTVV0aWxzLmdldE9ic1ZhbHVlKHZpZXdNb2RlbCwgJ0N1c3RvbWVyTm8nLCB7IGZpcnN0OiB0cnVlLCB0cmltOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWN1c3RvbWVyTm8gfHwgY3VzdG9tZXJObyA9PT0gbGFzdEN1c3RvbWVyTm8pIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgbGFzdEN1c3RvbWVyTm8gPSBjdXN0b21lck5vO1xuXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGFwcGx5Q2F0YWxvZ0ZvcihjdXN0b21lck5vLCB2aWV3TW9kZWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBib290ZWQgPSB0cnVlO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBib290ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGRlcnJvcihgJHtDRkcuTkFNRX0gaW5pdCBmYWlsZWQ6YCwgZSk7XG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICBib290aW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyA9PT09PSBDb3JlIGJ1c2luZXNzIGxvZ2ljOiBDdXN0b21lciBcdTIxOTIgQ2F0YWxvZ0tleSBcdTIxOTIgQ2F0YWxvZ0NvZGUgPT09PT1cbiAgICBhc3luYyBmdW5jdGlvbiBhcHBseUNhdGFsb2dGb3IoY3VzdG9tZXJObywgdm0pIHtcbiAgICAgICAgaWYgKCFjdXN0b21lck5vKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgdGFzayA9IGx0LmNvcmUuaHViLmJlZ2luVGFzaygnTGlua2luZyBjYXRhbG9nXHUyMDI2JywgJ2luZm8nKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gMSkgQ3VzdG9tZXIgXHUyMTkyIENhdGFsb2dLZXlcbiAgICAgICAgICAgIGNvbnN0IHJvd3MxID0gYXdhaXQgd2l0aEZyZXNoQXV0aCgoKSA9PlxuICAgICAgICAgICAgICAgIGx0LmNvcmUucGxleC5kc1Jvd3MoQ0ZHLkRTX0NBVEFMT0dfQllfQ1VTVE9NRVIsIHsgQ3VzdG9tZXJfTm86IGN1c3RvbWVyTm8gfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCByb3cxID0gQXJyYXkuaXNBcnJheShyb3dzMSkgPyByb3dzMVswXSA6IG51bGw7XG4gICAgICAgICAgICBjb25zdCBjYXRhbG9nS2V5ID0gcm93MT8uQ2F0YWxvZ19LZXkgfHwgMDtcbiAgICAgICAgICAgIGlmICghY2F0YWxvZ0tleSkgeyB0YXNrLmVycm9yKCdObyBjYXRhbG9nIGZvdW5kIGZvciB0aGlzIGN1c3RvbWVyLicpOyByZXR1cm47IH1cblxuICAgICAgICAgICAgLy8gMikgQ2F0YWxvZ0tleSBcdTIxOTIgQ2F0YWxvZ0NvZGVcbiAgICAgICAgICAgIGNvbnN0IHJvd3MyID0gYXdhaXQgd2l0aEZyZXNoQXV0aCgoKSA9PlxuICAgICAgICAgICAgICAgIGx0LmNvcmUucGxleC5kc1Jvd3MoQ0ZHLkRTX0NBVEFMT0dfQ09ERV9CWV9LRVksIHsgQ2F0YWxvZ19LZXk6IGNhdGFsb2dLZXkgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCBjYXRhbG9nQ29kZSA9IChBcnJheS5pc0FycmF5KHJvd3MyKSA/IHJvd3MyLm1hcChyID0+IHI/LkNhdGFsb2dfQ29kZSkuZmluZChCb29sZWFuKSA6IG51bGwpIHx8ICcnO1xuXG4gICAgICAgICAgICAvLyAzKSBSZWZsZWN0IGluIEtPXG4gICAgICAgICAgICBUTVV0aWxzLnNldE9ic1ZhbHVlKHZtLCAnQ2F0YWxvZ0tleScsIGNhdGFsb2dLZXkpO1xuICAgICAgICAgICAgVE1VdGlscy5zZXRPYnNWYWx1ZSh2bSwgJ0NhdGFsb2dDb2RlJywgY2F0YWxvZ0NvZGUpO1xuXG4gICAgICAgICAgICAvLyA0KSBTdGFzaCBpbnRvIERSQUZUIHNjb3BlIChwZXItdGFiKVxuICAgICAgICAgICAgLy8gYWZ0ZXIgeW91J3ZlIGNvbXB1dGVkIGNhdGFsb2dLZXksIGNhdGFsb2dDb2RlLCBldGMuXG4gICAgICAgICAgICBjb25zdCByZXBvID0gYXdhaXQgZW5zdXJlRHJhZnRSZXBvKCk7XG4gICAgICAgICAgICBpZiAocmVwbykge1xuICAgICAgICAgICAgICAgIC8vIG5ldyAobm9uLWJsb2NraW5nLCBhdXRvLXJldHJpZXMgdW50aWwgREMgaXMgcmVhZHkpXG4gICAgICAgICAgICAgICAgcGVyc2lzdERyYWZ0SGVhZGVyV2l0aFJldHJ5KHtcbiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJfTm86IFN0cmluZyhjdXN0b21lck5vKSxcbiAgICAgICAgICAgICAgICAgICAgQ2F0YWxvZ19LZXk6IE51bWJlcihjYXRhbG9nS2V5KSxcbiAgICAgICAgICAgICAgICAgICAgQ2F0YWxvZ19Db2RlOiBTdHJpbmcoY2F0YWxvZ0NvZGUgfHwgJycpLFxuICAgICAgICAgICAgICAgICAgICBDYXRhbG9nX0ZldGNoZWRfQXQ6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZWRfQXQ6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEJ1aWxkIGEgY2xlYW4gZGlzcGxheSB2YWx1ZSB0aGF0IGZhbGxzIGJhY2sgY29ycmVjdGx5XG4gICAgICAgICAgICBjb25zdCBjb2RlVHJpbW1lZCA9ICh0eXBlb2YgY2F0YWxvZ0NvZGUgPT09ICdzdHJpbmcnKSA/IGNhdGFsb2dDb2RlLnRyaW0oKSA6ICcnO1xuICAgICAgICAgICAgY29uc3QgZGlzcGxheSA9IGNvZGVUcmltbWVkIHx8IFN0cmluZyhjYXRhbG9nS2V5ID8/ICcnKTsgIC8vIGZhbGwgYmFjayB0byBrZXkgaWYgY29kZSBpcyBibGFua1xuXG4gICAgICAgICAgICAvLyBJZiB5b3VcdTIwMTlkIGxpa2UgdG8gc2hvdyBib3RoIHdoZW4gYXZhaWxhYmxlOlxuICAgICAgICAgICAgY29uc3QgbXNnID0gY29kZVRyaW1tZWQgPyBgTGlua2VkOiAke2NvZGVUcmltbWVkfSAoa2V5ICR7Y2F0YWxvZ0tleX0pYCA6IGBMaW5rZWQ6IGtleSAke2NhdGFsb2dLZXl9YDtcbiAgICAgICAgICAgIHRhc2suc3VjY2Vzcyhtc2cpO1xuICAgICAgICAgICAgLy8gRmxhc2ggc3VjY2VzcyBmb3IgfjNzIChjb3JlIEFQSSBpcyBub3RpZnkodGV4dCwgdG9uZSwgb3B0cykpXG4gICAgICAgICAgICBsdC5jb3JlLmh1Yi5ub3RpZnkobXNnLCBcInN1Y2Nlc3NcIiwgeyBtczogMzAwMCB9KTtcblxuXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgdGFzay5lcnJvcignTm8gY2F0YWxvZyBmb3VuZCBmb3IgdGhpcyBjdXN0b21lci4nKTtcbiAgICAgICAgICAgIGRlcnJvcihlcnIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gLS0tLSBCZXN0LWVmZm9ydCBwZXJzaXN0ZW5jZSB3aXRoIHJldHJ5IChkcmFmdCBoZWFkZXIpIC0tLS1cbiAgICBjb25zdCBfX1FUMTBfUEVSU0lTVCA9IHsgcXVldWU6IG51bGwsIHRpbWVyOiBudWxsIH07XG4gICAgYXN5bmMgZnVuY3Rpb24gcGVyc2lzdERyYWZ0SGVhZGVyV2l0aFJldHJ5KHBhdGNoLCBtYXhUcmllcyA9IDEyMCwgaW50ZXJ2YWxNcyA9IDI1MCkge1xuICAgICAgICAvLyBIZWxwZXI6IGFzayBsdC1jb3JlIHRvIHByb21vdGUgbGlrZSBxdDMwIGRvZXNcbiAgICAgICAgY29uc3QgcHJvbW90ZU5vdyA9IChtb2RlIC8qICdvbmNlJyB8ICdyZXRyeScgKi8pID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3R4ID0gbHQ/LmNvcmU/LnF0Py5nZXRRdW90ZUNvbnRleHQ/LigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHFrID0gTnVtYmVyKGN0eD8ucXVvdGVLZXkgfHwgMCk7XG4gICAgICAgICAgICAgICAgaWYgKHFrID4gMCkgbHQuY29yZS5xdC5wcm9tb3RlRHJhZnRUb1F1b3RlPy4oeyBxaywgc3RyYXRlZ3k6IG1vZGUgfSk7XG4gICAgICAgICAgICB9IGNhdGNoIHsgLyogbm9uLWZhdGFsICovIH1cbiAgICAgICAgfTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVwbyA9IGF3YWl0IGVuc3VyZURyYWZ0UmVwbygpOyAvLyBiZXN0LWVmZm9ydCwgbWF5IHJldHVybiBudWxsXG4gICAgICAgICAgICBpZiAocmVwbykge1xuICAgICAgICAgICAgICAgIGF3YWl0IHJlcG8ucGF0Y2hIZWFkZXIocGF0Y2gpO1xuICAgICAgICAgICAgICAgIC8vIE1pcnJvciBxdDMwIHN0YW5kYXJkOiBzaW5nbGUgYXR0ZW1wdCBmaXJzdFxuICAgICAgICAgICAgICAgIHByb21vdGVOb3coJ29uY2UnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygnUVQxMDogcmVwbyBub3QgcmVhZHkgbm93LCB3aWxsIHJldHJ5JywgZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBidWZmZXIgcGF0Y2ggYW5kIHNjaGVkdWxlIHJldHJpZXNcbiAgICAgICAgX19RVDEwX1BFUlNJU1QucXVldWUgPSB7IC4uLihfX1FUMTBfUEVSU0lTVC5xdWV1ZSB8fCB7fSksIC4uLnBhdGNoIH07XG5cbiAgICAgICAgaWYgKF9fUVQxMF9QRVJTSVNULnRpbWVyKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgbGV0IHRyaWVzTGVmdCA9IG1heFRyaWVzO1xuICAgICAgICBfX1FUMTBfUEVSU0lTVC50aW1lciA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVwb0xhdGVyID0gYXdhaXQgZW5zdXJlRHJhZnRSZXBvKCk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXBvTGF0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKC0tdHJpZXNMZWZ0IDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoX19RVDEwX1BFUlNJU1QudGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX19RVDEwX1BFUlNJU1QudGltZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdRVDEwOiByZXBvIG5ldmVyIGJlY2FtZSByZWFkeTsgZ2F2ZSB1cCBhZnRlciByZXRyaWVzJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gX19RVDEwX1BFUlNJU1QucXVldWU7XG4gICAgICAgICAgICAgICAgX19RVDEwX1BFUlNJU1QucXVldWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoX19RVDEwX1BFUlNJU1QudGltZXIpO1xuICAgICAgICAgICAgICAgIF9fUVQxMF9QRVJTSVNULnRpbWVyID0gbnVsbDtcblxuICAgICAgICAgICAgICAgIGF3YWl0IHJlcG9MYXRlci5wYXRjaEhlYWRlcihwYXlsb2FkKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmRlYnVnKCdRVDEwOiBkcmFmdCBwZXJzaXN0ZWQgYWZ0ZXIgcmV0cnknLCBwYXlsb2FkKTtcblxuICAgICAgICAgICAgICAgIC8vIFByb21vdGlvbiB3aW5kb3cgd2hlcmUgS08gbWF5IHN0aWxsIGJlIGJpbmRpbmcgLT4gYXNrIGx0LWNvcmUgdG8gaGFuZGxlIGl0cyBvd24gc2hvcnQgcmV0cnlcbiAgICAgICAgICAgICAgICBwcm9tb3RlTm93KCdyZXRyeScpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdRVDEwOiByZXRyeSBwZXJzaXN0IGVycm9yJywgZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgaW50ZXJ2YWxNcyk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuXG5cbiAgICAvLyA9PT09PSBTUEEgbmF2IGhhbmRsaW5nID09PT09XG4gICAgdW5zdWJzY3JpYmVVcmwgPSBUTVV0aWxzLm9uVXJsQ2hhbmdlPy4oKCkgPT4ge1xuICAgICAgICBpZiAoIUNGRy5ST1VURVMuc29tZShyeCA9PiByeC50ZXN0KGxvY2F0aW9uLnBhdGhuYW1lKSkpIHtcbiAgICAgICAgICAgIHRyeSB7IGRpc3Bvc2VXYXRjaGVyPy4oKTsgfSBjYXRjaCB7IH1cbiAgICAgICAgICAgIGRpc3Bvc2VXYXRjaGVyID0gbnVsbDsgYm9vdGVkID0gZmFsc2U7IGJvb3RpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzZXRUaW1lb3V0KG1heWJlQm9vdCwgMCk7XG4gICAgfSk7XG5cbiAgICBzZXRUaW1lb3V0KG1heWJlQm9vdCwgMCk7XG5cbiAgICAvLyBFeHBvc2UgaGVscGVycyB0byB0aGUgcGFnZSBjb250ZXh0IChzbyBEZXZUb29scyBjb25zb2xlIGNhbiBjYWxsIHRoZW0pXG4gICAgY29uc3QgVyA9ICh0eXBlb2YgdW5zYWZlV2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHVuc2FmZVdpbmRvdyA6IHdpbmRvdyk7XG5cbiAgICBXLlFUMTBfZGVidWdEcmFmdCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVwbyA9IGF3YWl0IGVuc3VyZURyYWZ0UmVwbygpO1xuICAgICAgICBjb25zdCBzbmFwID0gYXdhaXQgcmVwbz8uZ2V0KCk7XG4gICAgICAgIGNvbnNvbGUuZGVidWcoJ1FUMTAgZHJhZnQgXHUyMTkyJywgc25hcCk7XG4gICAgICAgIHJldHVybiBzbmFwO1xuICAgIH07XG5cbiAgICBXLlFUMTBfZm9yY2VEcmFmdCA9IGFzeW5jIChwYXRjaCA9IHt9KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcG8gPSBhd2FpdCBlbnN1cmVEcmFmdFJlcG8oKTtcbiAgICAgICAgaWYgKCFyZXBvKSB7IGNvbnNvbGUud2FybignUVQxMDogcmVwbyBub3QgcmVhZHknKTsgcmV0dXJuIG51bGw7IH1cbiAgICAgICAgYXdhaXQgcmVwby5wYXRjaEhlYWRlcih7XG4gICAgICAgICAgICBDdXN0b21lcl9ObzogJ1RFU1QnLFxuICAgICAgICAgICAgQ2F0YWxvZ19LZXk6IDk5OTk5LFxuICAgICAgICAgICAgQ2F0YWxvZ19Db2RlOiAnVGVzdENhdGFsb2cnLFxuICAgICAgICAgICAgVXBkYXRlZF9BdDogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgIC4uLnBhdGNoXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYXdhaXQgcmVwby5nZXQoKTtcbiAgICB9O1xuXG4gICAgVy5RVDEwX2NoZWNrREMgPSAoKSA9PiAhIShsdD8uY29yZT8uZGF0YT8ubWFrZUZsYXRTY29wZWRSZXBvKTtcbiAgICBXLlFUMTBfZGNTdGF0dXMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGhhc0ZhY3RvcnkgPSAhIShsdD8uY29yZT8uZGF0YT8ubWFrZUZsYXRTY29wZWRSZXBvKTtcbiAgICAgICAgcmV0dXJuIHsgaGFzQ29yZTogaGFzRmFjdG9yeSwgaGFzRmFjdG9yeSB9O1xuICAgIH07XG5cbn0pKCk7Il0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUlBLEdBQUMsaUJBQWtCO0FBRWY7QUFHQSxVQUFNLE1BQU8s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
