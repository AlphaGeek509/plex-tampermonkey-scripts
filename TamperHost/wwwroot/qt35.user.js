// ==UserScript==
// @name        QT35_DEV
// @namespace   https://github.com/AlphaGeek509/plex-tampermonkey-scripts
// @version     3.8.37
// @description DEV-only build; includes user-start gate
// @match       https://lyntron.on.plex.com/SalesAndCRM*
// @match       https://lyntron.on.plex.com/SalesAndCrm*
// @match       https://lyntron.test.on.plex.com/SalesAndCRM*
// @match       https://lyntron.test.on.plex.com/SalesAndCrm*
// @require      http://localhost:5000/lt-plex-tm-utils.user.js?v=3.8.37-1758668539388
// @require      http://localhost:5000/lt-plex-auth.user.js?v=3.8.37-1758668539388
// @require      http://localhost:5000/lt-ui-hub.js?v=3.8.37-1758668539388
// @require      http://localhost:5000/lt-data-core.user.js?v=3.8.37-1758668539388
// @require      http://localhost:5000/lt-core.user.js?v=3.8.37-1758668539388
// @resource     THEME_CSS http://localhost:5000/theme.css
// @grant       GM_registerMenuCommand
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_xmlhttpRequest
// @grant       unsafeWindow
// @connect     *.plex.com
// @run-at      document-start
// @noframes
// @grant        GM_addStyle
// @grant        GM_getResourceText
// @updateURL   http://localhost:5000/qt35.user.js
// @downloadURL http://localhost:5000/qt35.user.js
// ==/UserScript==

(() => {
  // src/quote-tracking/qt35-attachmentsGet/qt35.index.js
  (() => {
    "use strict";
    const DEV = true ? true : true;
    const dlog = (...a) => DEV && console.debug("QT35", ...a);
    const derr = (...a) => console.error("QT35 \u2716\uFE0F", ...a);
    const ROOT = typeof unsafeWindow !== "undefined" ? unsafeWindow : window;
    const withFreshAuth = (fn) => {
      const impl = lt?.core?.auth?.withFreshAuth;
      return typeof impl === "function" ? impl(fn) : fn();
    };
    const QTF = lt.core?.data?.makeFlatScopedRepo ? lt.core.data.makeFlatScopedRepo({ ns: "QT", entity: "quote", legacyEntity: "QuoteHeader" }) : null;
    (async () => {
      const dock = await window.ensureLTDock?.();
      dock?.register({
        id: "qt35-attachments",
        label: "Attachments",
        title: "Open QT35 Attachments",
        weight: 120,
        onClick: () => typeof openAttachmentsModal === "function" ? openAttachmentsModal() : lt.core.hub.notify("Attachments UI not available", "warn", { toast: true })
      });
    })();
    const ROUTES = [/^\/SalesAndCRM\/QuoteWizard(?:\/|$)/i];
    const FORCE_SHOW_BTN = false;
    if (!ROUTES.some((rx) => rx.test(location.pathname))) return;
    ROOT.__LT_HUB_MOUNT = "nav";
    const KO = typeof unsafeWindow !== "undefined" ? unsafeWindow.ko : window.ko;
    const raf = () => new Promise((r) => requestAnimationFrame(r));
    const CFG = {
      ACTION_BAR_SEL: "#QuoteWizardSharedActionBar",
      GRID_SEL: ".plex-grid",
      //SHOW_ON_PAGES_RE: /\bsummary\b/i,
      SHOW_ON_PAGES_RE: /^part\s*summary$/i,
      DS_ATTACHMENTS_BY_QUOTE: 11713,
      ATTACHMENT_GROUP_KEY: 11,
      DS_QUOTE_HEADER_GET: 3156,
      POLL_MS: 200,
      TIMEOUT_MS: 12e3
    };
    function getTabScopeId(ns = "QT") {
      try {
        const k = `lt:${ns}:scopeId`;
        let v = sessionStorage.getItem(k);
        if (!v) {
          v = String(Math.floor(Math.random() * 2147483647));
          sessionStorage.setItem(k, v);
        }
        return Number(v);
      } catch {
        return Math.floor(Math.random() * 2147483647);
      }
    }
    async function ensureWizardVM() {
      const anchor = document.querySelector(CFG.GRID_SEL) ? CFG.GRID_SEL : CFG.ACTION_BAR_SEL;
      const { viewModel } = await (window.TMUtils?.waitForModelAsync(anchor, { pollMs: CFG.POLL_MS, timeoutMs: CFG.TIMEOUT_MS, requireKo: true }) ?? { viewModel: null });
      return viewModel;
    }
    const QT_CTX = lt?.core?.qt?.getQuoteContext();
    let quoteRepo = null, lastScope = null;
    let __QT__ = null;
    async function ensureRepoForQuote(quoteKey) {
      if (!QTF) return null;
      const { repo } = QTF.use(Number(quoteKey));
      quoteRepo = repo;
      lastScope = Number(quoteKey);
      await repo.ensureFromLegacyIfMissing?.();
      return repo;
    }
    const __PROMOTE = { timer: null, tries: 0, max: 120, intervalMs: 250 };
    function schedulePromoteDraftToQuote(qk) {
      return lt?.core?.qt?.promoteDraftToQuote({ qk: Number(qk), strategy: "retry" });
    }
    function stopPromote() {
      return lt?.core?.qt?.stopRetry?.();
    }
    async function mergeDraftIntoQuoteOnce(qk) {
      return lt?.core?.qt?.promoteDraftToQuote({ qk: Number(qk), strategy: "once" });
    }
    async function fetchAttachmentCount(quoteKey) {
      const plex = typeof getPlexFacade === "function" ? await getPlexFacade() : ROOT.lt?.core?.plex;
      if (!plex?.dsRows) return 0;
      const rows = await withFreshAuth(() => plex.dsRows(CFG.DS_ATTACHMENTS_BY_QUOTE, {
        Attachment_Group_Key: CFG.ATTACHMENT_GROUP_KEY,
        Record_Key_Value: String(quoteKey)
      }));
      return Array.isArray(rows) ? rows.length : 0;
    }
    function quoteHeaderGet(row) {
      return {
        Customer_Code: row?.Customer_Code ?? null,
        Customer_Name: row?.Customer_Name ?? null,
        Customer_No: row?.Customer_No ?? null,
        Quote_No: row?.Quote_No ?? null
      };
    }
    async function hydratePartSummaryOnce(qk) {
      await ensureRepoForQuote(qk);
      if (!quoteRepo) return;
      const headerSnap = await quoteRepo.getHeader() || {};
      if (headerSnap.Quote_Header_Fetched_At) return;
      const plex = typeof getPlexFacade === "function" ? await getPlexFacade() : ROOT.lt?.core?.plex;
      if (!plex?.dsRows) return;
      const rows = await withFreshAuth(() => plex.dsRows(CFG.DS_QUOTE_HEADER_GET, { Quote_Key: String(qk) }));
      const first = Array.isArray(rows) && rows.length ? quoteHeaderGet(rows[0]) : null;
      if (!first) return;
      await quoteRepo.patchHeader({ Quote_Key: qk, ...first, Quote_Header_Fetched_At: Date.now() });
    }
    const HUB_BTN_ID = "qt35-attachments-btn";
    async function setBadgeCount(n) {
      const count = Number(n ?? 0);
      const hub = await lt.core.qt.getHub({ mount: "nav" });
      if (!hub?.registerButton) return;
      if (typeof hub.updateButton === "function") {
        hub.updateButton(HUB_BTN_ID, { label: `Attachments ${count}` });
        return;
      }
      const list = hub.list?.();
      const already = Array.isArray(list) && list.includes(HUB_BTN_ID);
      if (!already) {
        hub.registerButton("left", {
          id: HUB_BTN_ID,
          label: `Attachments ${count}`,
          title: "Refresh attachments (manual)",
          weight: 120,
          onClick: () => runOneRefresh(true)
        });
      } else {
        hub.remove?.(HUB_BTN_ID);
        hub.registerButton("left", {
          id: HUB_BTN_ID,
          label: `Attachments ${count}`,
          title: "Refresh attachments (manual)",
          weight: 120,
          onClick: () => runOneRefresh(true)
        });
      }
    }
    let refreshInFlight = false;
    async function runOneRefresh(manual = false) {
      await lt.core.qt.ensureHubButton({
        id: HUB_BTN_ID,
        label: "Attachments 0",
        title: "Refresh attachments (manual)",
        side: "left",
        weight: 120,
        onClick: () => runOneRefresh(true),
        showWhen: (ctx) => typeof FORCE_SHOW_BTN !== "undefined" && FORCE_SHOW_BTN || CFG.SHOW_ON_PAGES_RE.test(ctx.pageName) || ctx.isOnPartSummary,
        mount: "nav"
      });
      if (refreshInFlight) return;
      refreshInFlight = true;
      const t = lt.core.hub.beginTask("Fetching Attachments\u2026", "info");
      try {
        await ensureWizardVM();
        const qk = QT_CTX?.quoteKey;
        if (!qk || !Number.isFinite(qk) || qk <= 0) {
          setBadgeCount(0);
          t.error(`\u26A0\uFE0F Quote Key not found`, 4e3);
          return;
        }
        if (!quoteRepo || lastScope !== qk) {
          await ensureRepoForQuote(qk);
          try {
            const head = await quoteRepo?.getHeader?.();
            if (head?.Attachment_Count != null) setBadgeCount(Number(head.Attachment_Count));
          } catch {
          }
        }
        await mergeDraftIntoQuoteOnce(qk);
        if (!quoteRepo) {
          t.error("Data context not ready yet", 2e3);
          return;
        }
        const count = await fetchAttachmentCount(qk);
        setBadgeCount(count);
        await quoteRepo.patchHeader({ Quote_Key: qk, Attachment_Count: Number(count) });
        const ok = count > 0;
        t.success(ok ? `\u2705 ${count} attachment(s)` : "\u26A0\uFE0F No attachments", 2e3);
        if (manual) {
          lt.core.hub.notify(
            ok ? `\u2705 ${count} attachment(s)` : "\u26A0\uFE0F No attachments",
            ok ? "success" : "warn",
            { timeout: 2e3, toast: true }
          );
        }
        dlog("refresh", { qk, count });
      } catch (err) {
        derr("refresh failed", err);
        t.error(`\u274C Attachments refresh failed: ${err?.message || err}`, 4e3);
        lt.core.hub.notify(
          `\u274C Attachments refresh failed: ${err?.message || err}`,
          "error",
          { timeout: 4e3, toast: true }
        );
      } finally {
        refreshInFlight = false;
      }
    }
    let booted = false;
    let offUrl = null;
    function wireNav(handler) {
      offUrl?.();
      offUrl = window.TMUtils?.onUrlChange?.(handler);
    }
    async function init() {
      if (booted) return;
      booted = true;
      await lt.core.qt.ensureHubButton({
        id: "qt35-attachments-btn",
        label: "Attachments 0",
        title: "Refresh attachments (manual)",
        side: "left",
        weight: 120,
        onClick: () => runOneRefresh(true),
        showWhen: (ctx) => typeof FORCE_SHOW_BTN !== "undefined" && FORCE_SHOW_BTN || CFG.SHOW_ON_PAGES_RE.test(ctx.pageName) || ctx.isOnPartSummary,
        mount: "nav"
      });
    }
    function teardown() {
      booted = false;
      offUrl?.();
      offUrl = null;
      stopPromote();
    }
    init();
    wireNav(() => {
      if (ROUTES.some((rx) => rx.test(location.pathname))) init();
      else teardown();
    });
  })();
})();
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vdG0tc2NyaXB0cy9zcmMvcXVvdGUtdHJhY2tpbmcvcXQzNS1hdHRhY2htZW50c0dldC9xdDM1LmluZGV4LmpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvLyB0bS1zY3JpcHRzL3NyYy9xdW90ZS10cmFja2luZy9xdDM1LWF0dGFjaG1lbnRzR2V0L3F0MzUuaW5kZXguanNcblxuKCgpID0+IHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBjb25zdCBERVYgPSAodHlwZW9mIF9fQlVJTERfREVWX18gIT09ICd1bmRlZmluZWQnKSA/IF9fQlVJTERfREVWX18gOiB0cnVlO1xuICAgIGNvbnN0IGRsb2cgPSAoLi4uYSkgPT4gREVWICYmIGNvbnNvbGUuZGVidWcoJ1FUMzUnLCAuLi5hKTtcbiAgICBjb25zdCBkZXJyID0gKC4uLmEpID0+IGNvbnNvbGUuZXJyb3IoXCJRVDM1IFx1MjcxNlx1RkUwRlwiLCAuLi5hKTtcbiAgICBjb25zdCBST09UID0gKHR5cGVvZiB1bnNhZmVXaW5kb3cgIT09ICd1bmRlZmluZWQnID8gdW5zYWZlV2luZG93IDogd2luZG93KTtcblxuICAgIC8vIFNhZmUgZGVsZWdhdGluZyB3cmFwcGVyOiB1c2UgbHQuY29yZS5hdXRoLndpdGhGcmVzaEF1dGggd2hlbiBhdmFpbGFibGUsXG4gICAgLy8gb3RoZXJ3aXNlIGp1c3QgcnVuIHRoZSBjYWxsYmFjayBvbmNlIChiZXN0LWVmZm9ydCBmYWxsYmFjaykuXG4gICAgY29uc3Qgd2l0aEZyZXNoQXV0aCA9IChmbikgPT4ge1xuICAgICAgICBjb25zdCBpbXBsID0gbHQ/LmNvcmU/LmF1dGg/LndpdGhGcmVzaEF1dGg7XG4gICAgICAgIHJldHVybiAodHlwZW9mIGltcGwgPT09ICdmdW5jdGlvbicpID8gaW1wbChmbikgOiBmbigpO1xuICAgIH07XG5cblxuICAgIC8vIEZsYXQgcmVwbyBmYWN0b3J5IChubyBwb2xsaW5nIHJlcXVpcmVkIG5vdyB0aGF0IGx0LWRhdGEtY29yZSBpbnN0YWxscyBhdCBkb2Mtc3RhcnQpXG4gICAgY29uc3QgUVRGID0gbHQuY29yZT8uZGF0YT8ubWFrZUZsYXRTY29wZWRSZXBvXG4gICAgICAgID8gbHQuY29yZS5kYXRhLm1ha2VGbGF0U2NvcGVkUmVwbyh7IG5zOiBcIlFUXCIsIGVudGl0eTogXCJxdW90ZVwiLCBsZWdhY3lFbnRpdHk6IFwiUXVvdGVIZWFkZXJcIiB9KVxuICAgICAgICA6IG51bGw7XG5cbiAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBlbnN1cmVMVERvY2sgaXMgcHJvdmlkZWQgYnkgQHJlcXVpcmVcdTIwMTlkIGx0LXVpLWRvY2suanNcbiAgICAgICAgY29uc3QgZG9jayA9IGF3YWl0IHdpbmRvdy5lbnN1cmVMVERvY2s/LigpO1xuICAgICAgICBkb2NrPy5yZWdpc3Rlcih7XG4gICAgICAgICAgICBpZDogJ3F0MzUtYXR0YWNobWVudHMnLFxuICAgICAgICAgICAgbGFiZWw6ICdBdHRhY2htZW50cycsXG4gICAgICAgICAgICB0aXRsZTogJ09wZW4gUVQzNSBBdHRhY2htZW50cycsXG4gICAgICAgICAgICB3ZWlnaHQ6IDEyMCxcbiAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+ICh0eXBlb2Ygb3BlbkF0dGFjaG1lbnRzTW9kYWwgPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IG9wZW5BdHRhY2htZW50c01vZGFsKClcbiAgICAgICAgICAgICAgICA6IGx0LmNvcmUuaHViLm5vdGlmeSgnQXR0YWNobWVudHMgVUkgbm90IGF2YWlsYWJsZScsICd3YXJuJywgeyB0b2FzdDogdHJ1ZSB9KSlcbiAgICAgICAgfSk7XG4gICAgfSkoKTtcblxuXG4gICAgY29uc3QgUk9VVEVTID0gWy9eXFwvU2FsZXNBbmRDUk1cXC9RdW90ZVdpemFyZCg/OlxcL3wkKS9pXTtcbiAgICBjb25zdCBGT1JDRV9TSE9XX0JUTiA9IGZhbHNlOyAvLyBzZXQgdG8gdHJ1ZSBkdXJpbmcgdGVzdGluZ1xuICAgIGlmICghUk9VVEVTLnNvbWUocnggPT4gcngudGVzdChsb2NhdGlvbi5wYXRobmFtZSkpKSByZXR1cm47XG5cbiAgICAvLyBNb3VudCBodWIgaW50byB0aGUgTkFWIGJhciBsaWtlIFFUMTBcbiAgICAvLyBOT1RFOiBEbyBub3QgYXdhaXQgYXQgdG9wLWxldmVsLiBpbml0KCkgcGVyZm9ybXMgdGhlIGF3YWl0ZWQgbW91bnQuXG4gICAgUk9PVC5fX0xUX0hVQl9NT1VOVCA9IFwibmF2XCI7XG5cbiAgICBjb25zdCBLTyA9ICh0eXBlb2YgdW5zYWZlV2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHVuc2FmZVdpbmRvdy5rbyA6IHdpbmRvdy5rbyk7XG4gICAgY29uc3QgcmFmID0gKCkgPT4gbmV3IFByb21pc2UociA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocikpO1xuXG4gICAgY29uc3QgQ0ZHID0ge1xuICAgICAgICBBQ1RJT05fQkFSX1NFTDogJyNRdW90ZVdpemFyZFNoYXJlZEFjdGlvbkJhcicsXG4gICAgICAgIEdSSURfU0VMOiAnLnBsZXgtZ3JpZCcsXG4gICAgICAgIC8vU0hPV19PTl9QQUdFU19SRTogL1xcYnN1bW1hcnlcXGIvaSxcbiAgICAgICAgU0hPV19PTl9QQUdFU19SRTogL15wYXJ0XFxzKnN1bW1hcnkkL2ksXG4gICAgICAgIERTX0FUVEFDSE1FTlRTX0JZX1FVT1RFOiAxMTcxMyxcbiAgICAgICAgQVRUQUNITUVOVF9HUk9VUF9LRVk6IDExLFxuICAgICAgICBEU19RVU9URV9IRUFERVJfR0VUOiAzMTU2LFxuICAgICAgICBQT0xMX01TOiAyMDAsXG4gICAgICAgIFRJTUVPVVRfTVM6IDEyMDAwXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldFRhYlNjb3BlSWQobnMgPSAnUVQnKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBrID0gYGx0OiR7bnN9OnNjb3BlSWRgO1xuICAgICAgICAgICAgbGV0IHYgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGspO1xuICAgICAgICAgICAgaWYgKCF2KSB7XG4gICAgICAgICAgICAgICAgdiA9IFN0cmluZyhNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyMTQ3NDgzNjQ3KSk7XG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShrLCB2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBOdW1iZXIodik7XG4gICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIxNDc0ODM2NDcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZnVuY3Rpb24gZW5zdXJlV2l6YXJkVk0oKSB7XG4gICAgICAgIGNvbnN0IGFuY2hvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoQ0ZHLkdSSURfU0VMKSA/IENGRy5HUklEX1NFTCA6IENGRy5BQ1RJT05fQkFSX1NFTDtcbiAgICAgICAgY29uc3QgeyB2aWV3TW9kZWwgfSA9IGF3YWl0ICh3aW5kb3cuVE1VdGlscz8ud2FpdEZvck1vZGVsQXN5bmMoYW5jaG9yLCB7IHBvbGxNczogQ0ZHLlBPTExfTVMsIHRpbWVvdXRNczogQ0ZHLlRJTUVPVVRfTVMsIHJlcXVpcmVLbzogdHJ1ZSB9KSA/PyB7IHZpZXdNb2RlbDogbnVsbCB9KTtcbiAgICAgICAgcmV0dXJuIHZpZXdNb2RlbDtcbiAgICB9XG5cbiAgICBjb25zdCBRVF9DVFggPSBsdD8uY29yZT8ucXQ/LmdldFF1b3RlQ29udGV4dCgpO1xuXG4gICAgbGV0IHF1b3RlUmVwbyA9IG51bGwsIGxhc3RTY29wZSA9IG51bGw7XG4gICAgbGV0IF9fUVRfXyA9IG51bGw7XG5cbiAgICBhc3luYyBmdW5jdGlvbiBlbnN1cmVSZXBvRm9yUXVvdGUocXVvdGVLZXkpIHtcbiAgICAgICAgaWYgKCFRVEYpIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCB7IHJlcG8gfSA9IFFURi51c2UoTnVtYmVyKHF1b3RlS2V5KSk7XG4gICAgICAgIHF1b3RlUmVwbyA9IHJlcG87ICAgICAgICAgICAgICAgICAvLyA8LS0gYmluZCB0aGUgbW9kdWxlLWxldmVsIGhhbmRsZVxuICAgICAgICBsYXN0U2NvcGUgPSBOdW1iZXIocXVvdGVLZXkpOyAgICAgLy8gPC0tIHRyYWNrIHNjb3BlIHdlXHUyMDE5cmUgYm91bmQgdG9cbiAgICAgICAgYXdhaXQgcmVwby5lbnN1cmVGcm9tTGVnYWN5SWZNaXNzaW5nPy4oKTtcbiAgICAgICAgcmV0dXJuIHJlcG87XG4gICAgfVxuXG4gICAgLy8gQmFja2dyb3VuZCBwcm9tb3Rpb24gKHBlci10YWIgZHJhZnQgLT4gcGVyLXF1b3RlKSB3aXRoIGdlbnRsZSByZXRyaWVzXG4gICAgY29uc3QgX19QUk9NT1RFID0geyB0aW1lcjogbnVsbCwgdHJpZXM6IDAsIG1heDogMTIwLCBpbnRlcnZhbE1zOiAyNTAgfTtcbiAgICBmdW5jdGlvbiBzY2hlZHVsZVByb21vdGVEcmFmdFRvUXVvdGUocWspIHtcbiAgICAgICAgcmV0dXJuIGx0Py5jb3JlPy5xdD8ucHJvbW90ZURyYWZ0VG9RdW90ZSh7IHFrOiBOdW1iZXIocWspLCBzdHJhdGVneTogJ3JldHJ5JyB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdG9wUHJvbW90ZSgpIHtcbiAgICAgICAgcmV0dXJuIGx0Py5jb3JlPy5xdD8uc3RvcFJldHJ5Py4oKTtcbiAgICB9XG5cbiAgICBhc3luYyBmdW5jdGlvbiBtZXJnZURyYWZ0SW50b1F1b3RlT25jZShxaykge1xuICAgICAgICByZXR1cm4gbHQ/LmNvcmU/LnF0Py5wcm9tb3RlRHJhZnRUb1F1b3RlKHsgcWs6IE51bWJlcihxayksIHN0cmF0ZWd5OiAnb25jZScgfSk7XG4gICAgfVxuXG4gICAgLy8gPT09PT0gRGF0YSBzb3VyY2VzID09PT09XG4gICAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hBdHRhY2htZW50Q291bnQocXVvdGVLZXkpIHtcbiAgICAgICAgY29uc3QgcGxleCA9ICh0eXBlb2YgZ2V0UGxleEZhY2FkZSA9PT0gXCJmdW5jdGlvblwiKSA/IGF3YWl0IGdldFBsZXhGYWNhZGUoKSA6IChST09ULmx0Py5jb3JlPy5wbGV4KTtcbiAgICAgICAgaWYgKCFwbGV4Py5kc1Jvd3MpIHJldHVybiAwO1xuICAgICAgICBjb25zdCByb3dzID0gYXdhaXQgd2l0aEZyZXNoQXV0aCgoKSA9PiBwbGV4LmRzUm93cyhDRkcuRFNfQVRUQUNITUVOVFNfQllfUVVPVEUsIHtcbiAgICAgICAgICAgIEF0dGFjaG1lbnRfR3JvdXBfS2V5OiBDRkcuQVRUQUNITUVOVF9HUk9VUF9LRVksXG4gICAgICAgICAgICBSZWNvcmRfS2V5X1ZhbHVlOiBTdHJpbmcocXVvdGVLZXkpXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkocm93cykgPyByb3dzLmxlbmd0aCA6IDA7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcXVvdGVIZWFkZXJHZXQocm93KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBDdXN0b21lcl9Db2RlOiByb3c/LkN1c3RvbWVyX0NvZGUgPz8gbnVsbCxcbiAgICAgICAgICAgIEN1c3RvbWVyX05hbWU6IHJvdz8uQ3VzdG9tZXJfTmFtZSA/PyBudWxsLFxuICAgICAgICAgICAgQ3VzdG9tZXJfTm86IHJvdz8uQ3VzdG9tZXJfTm8gPz8gbnVsbCxcbiAgICAgICAgICAgIFF1b3RlX05vOiByb3c/LlF1b3RlX05vID8/IG51bGxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgYXN5bmMgZnVuY3Rpb24gaHlkcmF0ZVBhcnRTdW1tYXJ5T25jZShxaykge1xuICAgICAgICBhd2FpdCBlbnN1cmVSZXBvRm9yUXVvdGUocWspO1xuICAgICAgICBpZiAoIXF1b3RlUmVwbykgcmV0dXJuO1xuICAgICAgICBjb25zdCBoZWFkZXJTbmFwID0gKGF3YWl0IHF1b3RlUmVwby5nZXRIZWFkZXIoKSkgfHwge307XG4gICAgICAgIGlmIChoZWFkZXJTbmFwLlF1b3RlX0hlYWRlcl9GZXRjaGVkX0F0KSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgcGxleCA9ICh0eXBlb2YgZ2V0UGxleEZhY2FkZSA9PT0gXCJmdW5jdGlvblwiID8gYXdhaXQgZ2V0UGxleEZhY2FkZSgpIDogUk9PVC5sdD8uY29yZT8ucGxleCk7XG4gICAgICAgIGlmICghcGxleD8uZHNSb3dzKSByZXR1cm47XG4gICAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCB3aXRoRnJlc2hBdXRoKCgpID0+IHBsZXguZHNSb3dzKENGRy5EU19RVU9URV9IRUFERVJfR0VULCB7IFF1b3RlX0tleTogU3RyaW5nKHFrKSB9KSk7XG5cbiAgICAgICAgY29uc3QgZmlyc3QgPSAoQXJyYXkuaXNBcnJheShyb3dzKSAmJiByb3dzLmxlbmd0aCkgPyBxdW90ZUhlYWRlckdldChyb3dzWzBdKSA6IG51bGw7XG4gICAgICAgIGlmICghZmlyc3QpIHJldHVybjtcblxuICAgICAgICBhd2FpdCBxdW90ZVJlcG8ucGF0Y2hIZWFkZXIoeyBRdW90ZV9LZXk6IHFrLCAuLi5maXJzdCwgUXVvdGVfSGVhZGVyX0ZldGNoZWRfQXQ6IERhdGUubm93KCkgfSk7XG4gICAgfVxuXG4gICAgLy8gPT09PT0gSHViIGJ1dHRvbiA9PT09PVxuICAgIGNvbnN0IEhVQl9CVE5fSUQgPSAncXQzNS1hdHRhY2htZW50cy1idG4nO1xuXG4gICAgYXN5bmMgZnVuY3Rpb24gc2V0QmFkZ2VDb3VudChuKSB7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gTnVtYmVyKG4gPz8gMCk7XG4gICAgICAgIGNvbnN0IGh1YiA9IGF3YWl0IGx0LmNvcmUucXQuZ2V0SHViKHsgbW91bnQ6IFwibmF2XCIgfSk7XG4gICAgICAgIGlmICghaHViPy5yZWdpc3RlckJ1dHRvbikgcmV0dXJuO1xuXG4gICAgICAgIC8vIElmIGh1YiBzdXBwb3J0cyB1cGRhdGVCdXR0b24sIHVzZSBpdDsgb3RoZXJ3aXNlIG1pbmltYWwgY2h1cm5cbiAgICAgICAgaWYgKHR5cGVvZiBodWIudXBkYXRlQnV0dG9uID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBodWIudXBkYXRlQnV0dG9uKEhVQl9CVE5fSUQsIHsgbGFiZWw6IGBBdHRhY2htZW50cyAke2NvdW50fWAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGYWxsYmFjazogb25seSByZS1yZWdpc3RlciBpZiBub3QgcHJlc2VudCAoYXZvaWQgcmVtb3ZlL3JlLWFkZCBjaHVybilcbiAgICAgICAgY29uc3QgbGlzdCA9IGh1Yi5saXN0Py4oKTtcbiAgICAgICAgY29uc3QgYWxyZWFkeSA9IEFycmF5LmlzQXJyYXkobGlzdCkgJiYgbGlzdC5pbmNsdWRlcyhIVUJfQlROX0lEKTtcbiAgICAgICAgaWYgKCFhbHJlYWR5KSB7XG4gICAgICAgICAgICBodWIucmVnaXN0ZXJCdXR0b24oJ2xlZnQnLCB7XG4gICAgICAgICAgICAgICAgaWQ6IEhVQl9CVE5fSUQsXG4gICAgICAgICAgICAgICAgbGFiZWw6IGBBdHRhY2htZW50cyAke2NvdW50fWAsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdSZWZyZXNoIGF0dGFjaG1lbnRzIChtYW51YWwpJyxcbiAgICAgICAgICAgICAgICB3ZWlnaHQ6IDEyMCxcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiBydW5PbmVSZWZyZXNoKHRydWUpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIE5vIHVwZGF0ZSBBUEk7IGRvIGEgZ2VudGxlIHJlcGxhY2VcbiAgICAgICAgICAgIGh1Yi5yZW1vdmU/LihIVUJfQlROX0lEKTtcbiAgICAgICAgICAgIGh1Yi5yZWdpc3RlckJ1dHRvbignbGVmdCcsIHtcbiAgICAgICAgICAgICAgICBpZDogSFVCX0JUTl9JRCxcbiAgICAgICAgICAgICAgICBsYWJlbDogYEF0dGFjaG1lbnRzICR7Y291bnR9YCxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ1JlZnJlc2ggYXR0YWNobWVudHMgKG1hbnVhbCknLFxuICAgICAgICAgICAgICAgIHdlaWdodDogMTIwLFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHJ1bk9uZVJlZnJlc2godHJ1ZSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbGV0IHJlZnJlc2hJbkZsaWdodCA9IGZhbHNlO1xuICAgIGFzeW5jIGZ1bmN0aW9uIHJ1bk9uZVJlZnJlc2gobWFudWFsID0gZmFsc2UpIHtcbiAgICAgICAgYXdhaXQgbHQuY29yZS5xdC5lbnN1cmVIdWJCdXR0b24oe1xuICAgICAgICAgICAgaWQ6IEhVQl9CVE5fSUQsXG4gICAgICAgICAgICBsYWJlbDogJ0F0dGFjaG1lbnRzIDAnLFxuICAgICAgICAgICAgdGl0bGU6ICdSZWZyZXNoIGF0dGFjaG1lbnRzIChtYW51YWwpJyxcbiAgICAgICAgICAgIHNpZGU6ICdsZWZ0JyxcbiAgICAgICAgICAgIHdlaWdodDogMTIwLFxuICAgICAgICAgICAgb25DbGljazogKCkgPT4gcnVuT25lUmVmcmVzaCh0cnVlKSxcbiAgICAgICAgICAgIHNob3dXaGVuOiAoY3R4KSA9PlxuICAgICAgICAgICAgICAgICh0eXBlb2YgRk9SQ0VfU0hPV19CVE4gIT09ICd1bmRlZmluZWQnICYmIEZPUkNFX1NIT1dfQlROKSB8fFxuICAgICAgICAgICAgICAgIENGRy5TSE9XX09OX1BBR0VTX1JFLnRlc3QoY3R4LnBhZ2VOYW1lKSB8fFxuICAgICAgICAgICAgICAgIGN0eC5pc09uUGFydFN1bW1hcnksXG4gICAgICAgICAgICBtb3VudDogJ25hdidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHJlZnJlc2hJbkZsaWdodCkgcmV0dXJuO1xuICAgICAgICByZWZyZXNoSW5GbGlnaHQgPSB0cnVlO1xuICAgICAgICBjb25zdCB0ID0gbHQuY29yZS5odWIuYmVnaW5UYXNrKFwiRmV0Y2hpbmcgQXR0YWNobWVudHNcdTIwMjZcIiwgXCJpbmZvXCIpO1xuXG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGVuc3VyZVdpemFyZFZNKCk7XG4gICAgICAgICAgICBjb25zdCBxayA9IChRVF9DVFg/LnF1b3RlS2V5KTtcbiAgICAgICAgICAgIGlmICghcWsgfHwgIU51bWJlci5pc0Zpbml0ZShxaykgfHwgcWsgPD0gMCkge1xuICAgICAgICAgICAgICAgIHNldEJhZGdlQ291bnQoMCk7XG4gICAgICAgICAgICAgICAgdC5lcnJvcihgXHUyNkEwXHVGRTBGIFF1b3RlIEtleSBub3QgZm91bmRgLCA0MDAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElmIHNjb3BlIGNoYW5nZWQsIHBhaW50IGFueSBleGlzdGluZyBzbmFwc2hvdCBiZWZvcmUgZmV0Y2hpbmdcbiAgICAgICAgICAgIGlmICghcXVvdGVSZXBvIHx8IGxhc3RTY29wZSAhPT0gcWspIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBlbnN1cmVSZXBvRm9yUXVvdGUocWspO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlYWQgPSBhd2FpdCBxdW90ZVJlcG8/LmdldEhlYWRlcj8uKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChoZWFkPy5BdHRhY2htZW50X0NvdW50ICE9IG51bGwpIHNldEJhZGdlQ291bnQoTnVtYmVyKGhlYWQuQXR0YWNobWVudF9Db3VudCkpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggeyB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFByb21vdGUgJiBjbGVhciBkcmFmdCBCRUZPUkUgcGVyLXF1b3RlIHVwZGF0ZXNcbiAgICAgICAgICAgIGF3YWl0IG1lcmdlRHJhZnRJbnRvUXVvdGVPbmNlKHFrKTtcblxuICAgICAgICAgICAgLy8gSWYgREMgaXNuJ3QgcmVhZHkgeWV0LCByZXNvbHZlIHRoZSB0YXNrIHNvIHRoZSBwaWxsIGRvZXNuXHUyMDE5dCBzcGluIGZvcmV2ZXJcbiAgICAgICAgICAgIGlmICghcXVvdGVSZXBvKSB7XG4gICAgICAgICAgICAgICAgdC5lcnJvcignRGF0YSBjb250ZXh0IG5vdCByZWFkeSB5ZXQnLCAyMDAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgZmV0Y2hBdHRhY2htZW50Q291bnQocWspO1xuICAgICAgICAgICAgc2V0QmFkZ2VDb3VudChjb3VudCk7XG4gICAgICAgICAgICBhd2FpdCBxdW90ZVJlcG8ucGF0Y2hIZWFkZXIoeyBRdW90ZV9LZXk6IHFrLCBBdHRhY2htZW50X0NvdW50OiBOdW1iZXIoY291bnQpIH0pO1xuXG4gICAgICAgICAgICAvLyBBbHdheXMgcmVzb2x2ZSB0aGUgdGFza1xuICAgICAgICAgICAgY29uc3Qgb2sgPSBjb3VudCA+IDA7XG4gICAgICAgICAgICB0LnN1Y2Nlc3Mob2sgPyBgXHUyNzA1ICR7Y291bnR9IGF0dGFjaG1lbnQocylgIDogJ1x1MjZBMFx1RkUwRiBObyBhdHRhY2htZW50cycsIDIwMDApO1xuXG4gICAgICAgICAgICAvLyBPcHRpb25hbCB0b2FzdCB3aGVuIHVzZXIgY2xpY2tlZCBtYW51YWxseVxuICAgICAgICAgICAgaWYgKG1hbnVhbCkge1xuICAgICAgICAgICAgICAgIGx0LmNvcmUuaHViLm5vdGlmeShcbiAgICAgICAgICAgICAgICAgICAgb2sgPyBgXHUyNzA1ICR7Y291bnR9IGF0dGFjaG1lbnQocylgIDogJ1x1MjZBMFx1RkUwRiBObyBhdHRhY2htZW50cycsXG4gICAgICAgICAgICAgICAgICAgIG9rID8gJ3N1Y2Nlc3MnIDogJ3dhcm4nLFxuICAgICAgICAgICAgICAgICAgICB7IHRpbWVvdXQ6IDIwMDAsIHRvYXN0OiB0cnVlIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGxvZygncmVmcmVzaCcsIHsgcWssIGNvdW50IH0pO1xuXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZGVycigncmVmcmVzaCBmYWlsZWQnLCBlcnIpO1xuICAgICAgICAgICAgdC5lcnJvcihgXHUyNzRDIEF0dGFjaG1lbnRzIHJlZnJlc2ggZmFpbGVkOiAke2Vycj8ubWVzc2FnZSB8fCBlcnJ9YCwgNDAwMCk7XG4gICAgICAgICAgICBsdC5jb3JlLmh1Yi5ub3RpZnkoXG4gICAgICAgICAgICAgICAgYFx1Mjc0QyBBdHRhY2htZW50cyByZWZyZXNoIGZhaWxlZDogJHtlcnI/Lm1lc3NhZ2UgfHwgZXJyfWAsXG4gICAgICAgICAgICAgICAgJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICB7IHRpbWVvdXQ6IDQwMDAsIHRvYXN0OiB0cnVlIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICByZWZyZXNoSW5GbGlnaHQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLy8gPT09PT0gU1BBIHdpcmluZyA9PT09PVxuICAgIGxldCBib290ZWQgPSBmYWxzZTsgbGV0IG9mZlVybCA9IG51bGw7XG4gICAgZnVuY3Rpb24gd2lyZU5hdihoYW5kbGVyKSB7IG9mZlVybD8uKCk7IG9mZlVybCA9IHdpbmRvdy5UTVV0aWxzPy5vblVybENoYW5nZT8uKGhhbmRsZXIpOyB9XG5cbiAgICBhc3luYyBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICBpZiAoYm9vdGVkKSByZXR1cm47XG4gICAgICAgIGJvb3RlZCA9IHRydWU7XG5cbiAgICAgICAgYXdhaXQgbHQuY29yZS5xdC5lbnN1cmVIdWJCdXR0b24oe1xuICAgICAgICAgICAgaWQ6ICdxdDM1LWF0dGFjaG1lbnRzLWJ0bicsXG4gICAgICAgICAgICBsYWJlbDogJ0F0dGFjaG1lbnRzIDAnLFxuICAgICAgICAgICAgdGl0bGU6ICdSZWZyZXNoIGF0dGFjaG1lbnRzIChtYW51YWwpJyxcbiAgICAgICAgICAgIHNpZGU6ICdsZWZ0JyxcbiAgICAgICAgICAgIHdlaWdodDogMTIwLFxuICAgICAgICAgICAgb25DbGljazogKCkgPT4gcnVuT25lUmVmcmVzaCh0cnVlKSxcbiAgICAgICAgICAgIHNob3dXaGVuOiAoY3R4KSA9PiAodHlwZW9mIEZPUkNFX1NIT1dfQlROICE9PSAndW5kZWZpbmVkJyAmJiBGT1JDRV9TSE9XX0JUTikgfHwgQ0ZHLlNIT1dfT05fUEFHRVNfUkUudGVzdChjdHgucGFnZU5hbWUpIHx8IGN0eC5pc09uUGFydFN1bW1hcnksXG4gICAgICAgICAgICBtb3VudDogJ25hdidcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHRlYXJkb3duKCkge1xuICAgICAgICBib290ZWQgPSBmYWxzZTtcbiAgICAgICAgb2ZmVXJsPy4oKTtcbiAgICAgICAgb2ZmVXJsID0gbnVsbDtcbiAgICAgICAgc3RvcFByb21vdGUoKTsgLy8gZW5zdXJlIGJhY2tncm91bmQgdGltZXIgaXMgY2xlYXJlZFxuICAgICAgICAvLyBIdWIgdmlzaWJpbGl0eSBpcyBoYW5kbGVkIGNlbnRyYWxseSB2aWEgZW5zdXJlSHViQnV0dG9uKClcbiAgICB9XG5cbiAgICBpbml0KCk7XG5cbiAgICB3aXJlTmF2KCgpID0+IHsgaWYgKFJPVVRFUy5zb21lKHJ4ID0+IHJ4LnRlc3QobG9jYXRpb24ucGF0aG5hbWUpKSkgaW5pdCgpOyBlbHNlIHRlYXJkb3duKCk7IH0pO1xufSkoKTtcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxHQUFDLE1BQU07QUFDSDtBQUVBLFVBQU0sTUFBTyxPQUF3QyxPQUFnQjtBQUNyRSxVQUFNLE9BQU8sSUFBSSxNQUFNLE9BQU8sUUFBUSxNQUFNLFFBQVEsR0FBRyxDQUFDO0FBQ3hELFVBQU0sT0FBTyxJQUFJLE1BQU0sUUFBUSxNQUFNLHFCQUFXLEdBQUcsQ0FBQztBQUNwRCxVQUFNLE9BQVEsT0FBTyxpQkFBaUIsY0FBYyxlQUFlO0FBSW5FLFVBQU0sZ0JBQWdCLENBQUMsT0FBTztBQUMx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QUssUUFBUTtBQUNuQixVQUFFLFFBQVEsS0FBSyxVQUFLLEtBQUssbUJBQW1CLCtCQUFxQixHQUFJO0FBR3JFLFlBQUksUUFBUTtBQUNSLGFBQUcsS0FBSyxJQUFJO0FBQUEsWUFDUixLQUFLLFVBQUssS0FBSyxtQkFBbUI7QUFBQSxZQUNsQyxLQUFLLFlBQVk7QUFBQSxZQUNqQixFQUFFLFNBQVMsS0FBTSxPQUFPLEtBQUs7QUFBQSxVQUNqQztBQUFBLFFBQ0o7QUFDQSxhQUFLLFdBQVcsRUFBRSxJQUFJLE1BQU0sQ0FBQztBQUFBLE1BRWpDLFNBQVMsS0FBSztBQUNWLGFBQUssa0JBQWtCLEdBQUc7QUFDMUIsVUFBRSxNQUFNLHNDQUFpQyxLQUFLLFdBQVcsR0FBRyxJQUFJLEdBQUk7QUFDcEUsV0FBRyxLQUFLLElBQUk7QUFBQSxVQUNSLHNDQUFpQyxLQUFLLFdBQVcsR0FBRztBQUFBLFVBQ3BEO0FBQUEsVUFDQSxFQUFFLFNBQVMsS0FBTSxPQUFPLEtBQUs7QUFBQSxRQUNqQztBQUFBLE1BQ0osVUFBRTtBQUNFLDBCQUFrQjtBQUFBLE1BQ3RCO0FBQUEsSUFDSjtBQUlBLFFBQUksU0FBUztBQUFPLFFBQUksU0FBUztBQUNqQyxhQUFTLFFBQVEsU0FBUztBQUFFLGVBQVM7QUFBRyxlQUFTLE9BQU8sU0FBUyxjQUFjLE9BQU87QUFBQSxJQUFHO0FBRXpGLG1CQUFlLE9BQU87QUFDbEIsVUFBSSxPQUFRO0FBQ1osZUFBUztBQUVULFlBQU0sR0FBRyxLQUFLLEdBQUcsZ0JBQWdCO0FBQUEsUUFDN0IsSUFBSTtBQUFBLFFBQ0osT0FBTztBQUFBLFFBQ1AsT0FBTztBQUFBLFFBQ1AsTUFBTTtBQUFBLFFBQ04sUUFBUTtBQUFBLFFBQ1IsU0FBUyxNQUFNLGNBQWMsSUFBSTtBQUFBLFFBQ2pDLFVBQVUsQ0FBQyxRQUFTLE9BQU8sbUJBQW1CLGVBQWUsa0JBQW1CLElBQUksaUJBQWlCLEtBQUssSUFBSSxRQUFRLEtBQUssSUFBSTtBQUFBLFFBQy9ILE9BQU87QUFBQSxNQUNYLENBQUM7QUFBQSxJQUNMO0FBQ0EsYUFBUyxXQUFXO0FBQ2hCLGVBQVM7QUFDVCxlQUFTO0FBQ1QsZUFBUztBQUNULGtCQUFZO0FBQUEsSUFFaEI7QUFFQSxTQUFLO0FBRUwsWUFBUSxNQUFNO0FBQUUsVUFBSSxPQUFPLEtBQUssUUFBTSxHQUFHLEtBQUssU0FBUyxRQUFRLENBQUMsRUFBRyxNQUFLO0FBQUEsVUFBUSxVQUFTO0FBQUEsSUFBRyxDQUFDO0FBQUEsRUFDakcsR0FBRzsiLAogICJuYW1lcyI6IFtdCn0K
