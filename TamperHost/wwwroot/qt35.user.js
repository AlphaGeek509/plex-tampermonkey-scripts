// ==UserScript==
// @name        QT35_DEV
// @namespace   https://github.com/AlphaGeek509/plex-tampermonkey-scripts
// @version     3.8.130
// @description DEV-only build; includes user-start gate
// @match       https://lyntron.on.plex.com/SalesAndCRM/QuoteWizard*
// @match       https://lyntron.on.plex.com/SalesAndCrm/QuoteWizard*
// @match       https://lyntron.test.on.plex.com/SalesAndCRM/QuoteWizard*
// @match       https://lyntron.test.on.plex.com/SalesAndCrm/QuoteWizard*
// @require      http://localhost:5000/lt-plex-tm-utils.user.js?v=3.8.130-1758921588214
// @require      http://localhost:5000/lt-plex-auth.user.js?v=3.8.130-1758921588214
// @require      http://localhost:5000/lt-ui-hub.js?v=3.8.130-1758921588214
// @require      http://localhost:5000/lt-data-core.user.js?v=3.8.130-1758921588214
// @require      http://localhost:5000/lt-core.user.js?v=3.8.130-1758921588214
// @resource     THEME_CSS http://localhost:5000/theme.css
// @grant       GM_registerMenuCommand
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_xmlhttpRequest
// @grant       unsafeWindow
// @connect     *.plex.com
// @run-at      document-start
// @noframes
// @grant        GM_addStyle
// @grant        GM_getResourceText
// @updateURL   http://localhost:5000/qt35.user.js
// @downloadURL http://localhost:5000/qt35.user.js
// ==/UserScript==

(() => {
  // src/quote-tracking/qt35-attachmentsGet/qt35.index.js
  (() => {
    "use strict";
    const DEV = true ? true : true;
    const dlog = (...a) => DEV && console.debug("QT35", ...a);
    const derr = (...a) => console.error("QT35 \u2716\uFE0F", ...a);
    const ROOT = typeof unsafeWindow !== "undefined" ? unsafeWindow : window;
    const withFreshAuth = (fn) => {
      const impl = lt?.core?.auth?.withFreshAuth;
      return typeof impl === "function" ? impl(fn) : fn();
    };
    (async () => {
      const dock = await window.ensureLTDock?.();
      dock?.register({
        id: "qt35-attachments",
        label: "Attachments",
        title: "Open QT35 Attachments",
        weight: 120,
        onClick: () => typeof openAttachmentsModal === "function" ? openAttachmentsModal() : lt.core.hub.notify("Attachments UI not available", "warn", { toast: true })
      });
    })();
    const ROUTES = [/^\/SalesAndCRM\/QuoteWizard(?:\/|$)/i];
    const FORCE_SHOW_BTN = false;
    if (!ROUTES.some((rx) => rx.test(location.pathname))) return;
    const KO = typeof unsafeWindow !== "undefined" ? unsafeWindow.ko : window.ko;
    const raf = () => new Promise((r) => requestAnimationFrame(r));
    const CFG = {
      ACTION_BAR_SEL: "#QuoteWizardSharedActionBar",
      GRID_SEL: ".plex-grid",
      //SHOW_ON_PAGES_RE: /\bsummary\b/i,
      SHOW_ON_PAGES_RE: /^part\s*summary$/i,
      DS_ATTACHMENTS_BY_QUOTE: 11713,
      ATTACHMENT_GROUP_KEY: 11,
      DS_QUOTE_HEADER_GET: 3156,
      POLL_MS: 200,
      TIMEOUT_MS: 12e3
    };
    async function ensureWizardVM() {
      const anchor = document.querySelector(CFG.GRID_SEL) ? CFG.GRID_SEL : CFG.ACTION_BAR_SEL;
      const { viewModel } = await (window.TMUtils?.waitForModelAsync(anchor, { pollMs: CFG.POLL_MS, timeoutMs: CFG.TIMEOUT_MS, requireKo: true }) ?? { viewModel: null });
      return viewModel;
    }
    let quoteRepo = null, lastScope = null;
    let __QT__ = null;
    async function ensureRepoForQuote(quoteKey) {
      try {
        const repo = await lt?.core?.qt?.useQuoteRepo?.(Number(quoteKey));
        quoteRepo = repo;
        lastScope = Number(quoteKey);
        return repo;
      } catch {
        return null;
      }
    }
    const sleep = (ms) => new Promise((r) => setTimeout(r, ms));
    async function ensureRepoReady(qk, attempts = 6, delayMs = 250) {
      for (let i = 0; i < attempts; i++) {
        await ensureRepoForQuote(qk);
        if (quoteRepo) return quoteRepo;
        await sleep(delayMs);
      }
      return null;
    }
    function stopPromote() {
      return lt?.core?.qt?.stopRetry?.();
    }
    function __guardKeyForPromote(qk) {
      return `qt35:promoted:${Number(qk) || 0}`;
    }
    async function promoteDraftIfPresentOnce(qk) {
      const key = __guardKeyForPromote(qk);
      try {
        if (sessionStorage.getItem(key) === "1") return "guarded";
      } catch {
      }
      const draftRepo = await lt?.core?.qt?.useDraftRepo?.();
      const draft = draftRepo && (await draftRepo.getHeader?.() || await draftRepo.get?.());
      const hasDraft = !!(draft && Object.keys(draft).length);
      if (!hasDraft) return "no-draft";
      const res = await lt?.core?.qt?.promoteDraftToQuote?.({ qk: Number(qk), strategy: "once" }) || "noop";
      try {
        sessionStorage.setItem(key, "1");
      } catch {
      }
      return res;
    }
    async function fetchAttachmentCount(quoteKey) {
      const plex = typeof getPlexFacade === "function" ? await getPlexFacade() : ROOT.lt?.core?.plex;
      if (!plex?.dsRows) return 0;
      const rows = await withFreshAuth(() => plex.dsRows(CFG.DS_ATTACHMENTS_BY_QUOTE, {
        Attachment_Group_Key: CFG.ATTACHMENT_GROUP_KEY,
        Record_Key_Value: String(quoteKey)
      }));
      return Array.isArray(rows) ? rows.length : 0;
    }
    function quoteHeaderGet(row) {
      return {
        Customer_Code: row?.Customer_Code ?? null,
        Customer_Name: row?.Customer_Name ?? null,
        Customer_No: row?.Customer_No ?? null,
        Quote_No: row?.Quote_No ?? null
      };
    }
    const HUB_BTN_ID = "qt35-attachments-btn";
    async function setBadgeCount(n) {
      const count = Number(n ?? 0);
      const hub = await lt.core.qt.getHub({ mount: "nav" });
      if (!hub?.registerButton) return;
      const label = `Attachments (${count})`;
      if (typeof hub.updateButton === "function") {
        hub.updateButton(HUB_BTN_ID, { label });
        return;
      }
      const list = hub.list?.();
      const already = Array.isArray(list) && list.includes(HUB_BTN_ID);
      if (!already) {
        hub.registerButton("left", {
          id: HUB_BTN_ID,
          label,
          title: "Refresh attachments (manual)",
          weight: 120,
          onClick: () => runOneRefresh(true)
        });
      } else {
        hub.remove?.(HUB_BTN_ID);
        hub.registerButton("left", {
          id: HUB_BTN_ID,
          label: `Attachments ${count}`,
          title: "Refresh attachments (manual)",
          weight: 120,
          onClick: () => runOneRefresh(true)
        });
      }
    }
    let refreshInFlight = false;
    async function runOneRefresh(manual = false) {
      await lt.core.qt.ensureHubButton({
        id: HUB_BTN_ID,
        label: "Attachments (0)",
        title: "Refresh attachments (manual)",
        side: "left",
        weight: 120,
        onClick: () => runOneRefresh(true),
        showWhen: (ctx) => typeof FORCE_SHOW_BTN !== "undefined" && FORCE_SHOW_BTN || CFG.SHOW_ON_PAGES_RE.test(ctx.pageName) || ctx.isOnPartSummary,
        mount: "nav"
      });
      if (refreshInFlight) return;
      refreshInFlight = true;
      const t = lt.core.hub.beginTask("Fetching Attachments\u2026", "info");
      try {
        await ensureWizardVM();
        const ctx = lt?.core?.qt?.getQuoteContext?.();
        const qk = Number(ctx?.quoteKey);
        if (!qk || !Number.isFinite(qk) || qk <= 0) {
          setBadgeCount(0);
          t.error(`\u26A0\uFE0F Quote Key not found`, 4e3);
          return;
        }
        if (!quoteRepo || lastScope !== qk) {
          await ensureRepoForQuote(qk);
          try {
            const head = await quoteRepo?.getHeader?.();
            if (head?.Attachment_Count != null) setBadgeCount(Number(head.Attachment_Count));
          } catch {
          }
        }
        await promoteDraftIfPresentOnce(qk);
        await ensureRepoReady(qk, 6, 250);
        if (!quoteRepo) {
          t.error("Data context warming \u2014 try again in a moment", 2500);
          return;
        }
        const count = await fetchAttachmentCount(qk);
        setBadgeCount(count);
        await quoteRepo.patchHeader({ Quote_Key: qk, Attachment_Count: Number(count) });
        const ok = count > 0;
        t.success(ok ? `\u2705 ${count} attachment(s)` : "No attachments", 2e3);
        if (manual) {
          lt.core.hub.notify(
            ok ? `\u2705 ${count} attachment(s)` : "No attachments",
            ok ? "success" : "warn",
            { timeout: 2e3, toast: true }
          );
        }
        dlog("refresh", { qk, count });
      } catch (err) {
        derr("refresh failed", err);
        t.error(`\u274C Attachments refresh failed: ${err?.message || err}`, 4e3);
        lt.core.hub.notify(
          `\u274C Attachments refresh failed: ${err?.message || err}`,
          "error",
          { timeout: 4e3, toast: true }
        );
      } finally {
        refreshInFlight = false;
      }
    }
    let __qt35_autoRefreshTimer = null;
    function onAttachmentRefreshRequested(ev) {
      try {
        const ctx = lt?.core?.qt?.getQuoteContext?.();
        const onPartSummary = !!(ctx && (ctx.isOnPartSummary || CFG.SHOW_ON_PAGES_RE.test(ctx.pageName || "")));
        if (!onPartSummary) return;
        clearTimeout(__qt35_autoRefreshTimer);
        __qt35_autoRefreshTimer = setTimeout(() => {
          runOneRefresh(false);
        }, 350);
      } catch {
      }
    }
    let booted = false;
    let offUrl = null;
    function wireNav(handler) {
      offUrl?.();
      offUrl = window.TMUtils?.onUrlChange?.(handler);
    }
    async function init() {
      if (booted) return;
      booted = true;
      try {
        window.addEventListener("LT:AttachmentRefreshRequested", onAttachmentRefreshRequested, false);
      } catch {
      }
      await lt.core.qt.ensureHubButton({
        id: "qt35-attachments-btn",
        label: "Attachments (0)",
        title: "Refresh attachments (manual)",
        side: "left",
        weight: 120,
        onClick: () => runOneRefresh(true),
        showWhen: (ctx) => typeof FORCE_SHOW_BTN !== "undefined" && FORCE_SHOW_BTN || CFG.SHOW_ON_PAGES_RE.test(ctx.pageName) || ctx.isOnPartSummary,
        mount: "nav"
      });
    }
    function teardown() {
      booted = false;
      offUrl?.();
      offUrl = null;
      stopPromote();
      try {
        window.removeEventListener("LT:AttachmentRefreshRequested", onAttachmentRefreshRequested, false);
      } catch {
      }
    }
    init();
    wireNav(() => {
      if (ROUTES.some((rx) => rx.test(location.pathname))) init();
      else teardown();
    });
  })();
})();
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vdG0tc2NyaXB0cy9zcmMvcXVvdGUtdHJhY2tpbmcvcXQzNS1hdHRhY2htZW50c0dldC9xdDM1LmluZGV4LmpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvLyB0bS1zY3JpcHRzL3NyYy9xdW90ZS10cmFja2luZy9xdDM1LWF0dGFjaG1lbnRzR2V0L3F0MzUuaW5kZXguanNcblxuKCgpID0+IHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBjb25zdCBERVYgPSAodHlwZW9mIF9fQlVJTERfREVWX18gIT09ICd1bmRlZmluZWQnKSA/IF9fQlVJTERfREVWX18gOiB0cnVlO1xuICAgIGNvbnN0IGRsb2cgPSAoLi4uYSkgPT4gREVWICYmIGNvbnNvbGUuZGVidWcoJ1FUMzUnLCAuLi5hKTtcbiAgICBjb25zdCBkZXJyID0gKC4uLmEpID0+IGNvbnNvbGUuZXJyb3IoXCJRVDM1IFx1MjcxNlx1RkUwRlwiLCAuLi5hKTtcbiAgICBjb25zdCBST09UID0gKHR5cGVvZiB1bnNhZmVXaW5kb3cgIT09ICd1bmRlZmluZWQnID8gdW5zYWZlV2luZG93IDogd2luZG93KTtcblxuICAgIC8vIFNhZmUgZGVsZWdhdGluZyB3cmFwcGVyOiB1c2UgbHQuY29yZS5hdXRoLndpdGhGcmVzaEF1dGggd2hlbiBhdmFpbGFibGUsXG4gICAgLy8gb3RoZXJ3aXNlIGp1c3QgcnVuIHRoZSBjYWxsYmFjayBvbmNlIChiZXN0LWVmZm9ydCBmYWxsYmFjaykuXG4gICAgY29uc3Qgd2l0aEZyZXNoQXV0aCA9IChmbikgPT4ge1xuICAgICAgICBjb25zdCBpbXBsID0gbHQ/LmNvcmU/LmF1dGg/LndpdGhGcmVzaEF1dGg7XG4gICAgICAgIHJldHVybiAodHlwZW9mIGltcGwgPT09ICdmdW5jdGlvbicpID8gaW1wbChmbikgOiBmbigpO1xuICAgIH07XG5cbiAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBlbnN1cmVMVERvY2sgaXMgcHJvdmlkZWQgYnkgQHJlcXVpcmVcdTIwMTlkIGx0LXVpLWRvY2suanNcbiAgICAgICAgY29uc3QgZG9jayA9IGF3YWl0IHdpbmRvdy5lbnN1cmVMVERvY2s/LigpO1xuICAgICAgICBkb2NrPy5yZWdpc3Rlcih7XG4gICAgICAgICAgICBpZDogJ3F0MzUtYXR0YWNobWVudHMnLFxuICAgICAgICAgICAgbGFiZWw6ICdBdHRhY2htZW50cycsXG4gICAgICAgICAgICB0aXRsZTogJ09wZW4gUVQzNSBBdHRhY2htZW50cycsXG4gICAgICAgICAgICB3ZWlnaHQ6IDEyMCxcbiAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+ICh0eXBlb2Ygb3BlbkF0dGFjaG1lbnRzTW9kYWwgPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IG9wZW5BdHRhY2htZW50c01vZGFsKClcbiAgICAgICAgICAgICAgICA6IGx0LmNvcmUuaHViLm5vdGlmeSgnQXR0YWNobWVudHMgVUkgbm90IGF2YWlsYWJsZScsICd3YXJuJywgeyB0b2FzdDogdHJ1ZSB9KSlcbiAgICAgICAgfSk7XG4gICAgfSkoKTtcblxuXG4gICAgY29uc3QgUk9VVEVTID0gWy9eXFwvU2FsZXNBbmRDUk1cXC9RdW90ZVdpemFyZCg/OlxcL3wkKS9pXTtcbiAgICBjb25zdCBGT1JDRV9TSE9XX0JUTiA9IGZhbHNlOyAvLyBzZXQgdG8gdHJ1ZSBkdXJpbmcgdGVzdGluZ1xuICAgIGlmICghUk9VVEVTLnNvbWUocnggPT4gcngudGVzdChsb2NhdGlvbi5wYXRobmFtZSkpKSByZXR1cm47XG5cbiAgICBjb25zdCBLTyA9ICh0eXBlb2YgdW5zYWZlV2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHVuc2FmZVdpbmRvdy5rbyA6IHdpbmRvdy5rbyk7XG4gICAgY29uc3QgcmFmID0gKCkgPT4gbmV3IFByb21pc2UociA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocikpO1xuXG4gICAgY29uc3QgQ0ZHID0ge1xuICAgICAgICBBQ1RJT05fQkFSX1NFTDogJyNRdW90ZVdpemFyZFNoYXJlZEFjdGlvbkJhcicsXG4gICAgICAgIEdSSURfU0VMOiAnLnBsZXgtZ3JpZCcsXG4gICAgICAgIC8vU0hPV19PTl9QQUdFU19SRTogL1xcYnN1bW1hcnlcXGIvaSxcbiAgICAgICAgU0hPV19PTl9QQUdFU19SRTogL15wYXJ0XFxzKnN1bW1hcnkkL2ksXG4gICAgICAgIERTX0FUVEFDSE1FTlRTX0JZX1FVT1RFOiAxMTcxMyxcbiAgICAgICAgQVRUQUNITUVOVF9HUk9VUF9LRVk6IDExLFxuICAgICAgICBEU19RVU9URV9IRUFERVJfR0VUOiAzMTU2LFxuICAgICAgICBQT0xMX01TOiAyMDAsXG4gICAgICAgIFRJTUVPVVRfTVM6IDEyMDAwXG4gICAgfTtcblxuICAgIGFzeW5jIGZ1bmN0aW9uIGVuc3VyZVdpemFyZFZNKCkge1xuICAgICAgICBjb25zdCBhbmNob3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKENGRy5HUklEX1NFTCkgPyBDRkcuR1JJRF9TRUwgOiBDRkcuQUNUSU9OX0JBUl9TRUw7XG4gICAgICAgIGNvbnN0IHsgdmlld01vZGVsIH0gPSBhd2FpdCAod2luZG93LlRNVXRpbHM/LndhaXRGb3JNb2RlbEFzeW5jKGFuY2hvciwgeyBwb2xsTXM6IENGRy5QT0xMX01TLCB0aW1lb3V0TXM6IENGRy5USU1FT1VUX01TLCByZXF1aXJlS286IHRydWUgfSkgPz8geyB2aWV3TW9kZWw6IG51bGwgfSk7XG4gICAgICAgIHJldHVybiB2aWV3TW9kZWw7XG4gICAgfVxuXG4gICAgbGV0IHF1b3RlUmVwbyA9IG51bGwsIGxhc3RTY29wZSA9IG51bGw7XG4gICAgbGV0IF9fUVRfXyA9IG51bGw7XG5cbiAgICBhc3luYyBmdW5jdGlvbiBlbnN1cmVSZXBvRm9yUXVvdGUocXVvdGVLZXkpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcG8gPSBhd2FpdCBsdD8uY29yZT8ucXQ/LnVzZVF1b3RlUmVwbz8uKE51bWJlcihxdW90ZUtleSkpO1xuICAgICAgICAgICAgcXVvdGVSZXBvID0gcmVwbztcbiAgICAgICAgICAgIGxhc3RTY29wZSA9IE51bWJlcihxdW90ZUtleSk7XG4gICAgICAgICAgICByZXR1cm4gcmVwbztcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIC0tLSBCT1VOREVEIENPTlRFWFQgV0FSTS1VUCAobm8gaW5maW5pdGUgcG9sbGluZykgLS0tXG4gICAgY29uc3Qgc2xlZXAgPSAobXMpID0+IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCBtcykpO1xuICAgIGFzeW5jIGZ1bmN0aW9uIGVuc3VyZVJlcG9SZWFkeShxaywgYXR0ZW1wdHMgPSA2LCBkZWxheU1zID0gMjUwKSB7XG4gICAgICAgIC8vIFRyeSBhIGZldyBzaG9ydCB0aW1lcyB0byBhbGxvdyBEQy9SZXBvIHRvIGNvbWUgdXAgYWZ0ZXIgbW9kYWwgY2xvc2UvcHJvbW90ZVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF0dGVtcHRzOyBpKyspIHtcbiAgICAgICAgICAgIGF3YWl0IGVuc3VyZVJlcG9Gb3JRdW90ZShxayk7XG4gICAgICAgICAgICBpZiAocXVvdGVSZXBvKSByZXR1cm4gcXVvdGVSZXBvO1xuICAgICAgICAgICAgYXdhaXQgc2xlZXAoZGVsYXlNcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG5cbiAgICAvLyBCYWNrZ3JvdW5kIHByb21vdGlvbiAocGVyLXRhYiBkcmFmdCAtPiBwZXItcXVvdGUpIHdpdGggZ2VudGxlIHJldHJpZXNcbiAgICBmdW5jdGlvbiBzdG9wUHJvbW90ZSgpIHtcbiAgICAgICAgcmV0dXJuIGx0Py5jb3JlPy5xdD8uc3RvcFJldHJ5Py4oKTtcbiAgICB9XG5cbiAgICAvLyBQcm9tb3RlIHRoZSB0YWItc2NvcGUgZHJhZnQgaW50byB0aGUgcGVyLXF1b3RlIHJlcG8gb25seSBpZiBhIHJlYWwgZHJhZnQgZXhpc3RzLlxuICAgIC8vIEFsc28gZ3VhcmQgc28gd2UgZG9uJ3QgZXZlbiBhdHRlbXB0IG1vcmUgdGhhbiBvbmNlIHBlciBxdW90ZSBpbiB0aGlzIHRhYi5cbiAgICBmdW5jdGlvbiBfX2d1YXJkS2V5Rm9yUHJvbW90ZShxaykgeyByZXR1cm4gYHF0MzU6cHJvbW90ZWQ6JHtOdW1iZXIocWspIHx8IDB9YDsgfVxuXG4gICAgYXN5bmMgZnVuY3Rpb24gcHJvbW90ZURyYWZ0SWZQcmVzZW50T25jZShxaykge1xuICAgICAgICBjb25zdCBrZXkgPSBfX2d1YXJkS2V5Rm9yUHJvbW90ZShxayk7XG4gICAgICAgIHRyeSB7IGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGtleSkgPT09ICcxJykgcmV0dXJuICdndWFyZGVkJzsgfSBjYXRjaCB7IC8qIGlnbm9yZSAqLyB9XG5cbiAgICAgICAgLy8gT25seSBjYWxsIGludG8gY29yZSBpZiBhIGRyYWZ0IGFjdHVhbGx5IGV4aXN0c1xuICAgICAgICBjb25zdCBkcmFmdFJlcG8gPSBhd2FpdCBsdD8uY29yZT8ucXQ/LnVzZURyYWZ0UmVwbz8uKCk7XG4gICAgICAgIGNvbnN0IGRyYWZ0ID0gZHJhZnRSZXBvICYmICgoYXdhaXQgZHJhZnRSZXBvLmdldEhlYWRlcj8uKCkpIHx8IChhd2FpdCBkcmFmdFJlcG8uZ2V0Py4oKSkpO1xuICAgICAgICBjb25zdCBoYXNEcmFmdCA9ICEhKGRyYWZ0ICYmIE9iamVjdC5rZXlzKGRyYWZ0KS5sZW5ndGgpO1xuICAgICAgICBpZiAoIWhhc0RyYWZ0KSByZXR1cm4gJ25vLWRyYWZ0JztcblxuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBsdD8uY29yZT8ucXQ/LnByb21vdGVEcmFmdFRvUXVvdGU/Lih7IHFrOiBOdW1iZXIocWspLCBzdHJhdGVneTogJ29uY2UnIH0pIHx8ICdub29wJztcblxuICAgICAgICAvLyBDb3JlIGNsZWFycyB0aGUgZHJhZnQgb24gJ21lcmdlZCc7IGVpdGhlciB3YXksIHdlIGF2b2lkIHJlLWF0dGVtcHRzIGZvciB0aGlzIHRhYi9xdW90ZVxuICAgICAgICB0cnkgeyBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGtleSwgJzEnKTsgfSBjYXRjaCB7IC8qIGlnbm9yZSAqLyB9XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxuXG5cbiAgICAvLyA9PT09PSBEYXRhIHNvdXJjZXMgPT09PT1cbiAgICBhc3luYyBmdW5jdGlvbiBmZXRjaEF0dGFjaG1lbnRDb3VudChxdW90ZUtleSkge1xuICAgICAgICBjb25zdCBwbGV4ID0gKHR5cGVvZiBnZXRQbGV4RmFjYWRlID09PSBcImZ1bmN0aW9uXCIpID8gYXdhaXQgZ2V0UGxleEZhY2FkZSgpIDogKFJPT1QubHQ/LmNvcmU/LnBsZXgpO1xuICAgICAgICBpZiAoIXBsZXg/LmRzUm93cykgcmV0dXJuIDA7XG4gICAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCB3aXRoRnJlc2hBdXRoKCgpID0+IHBsZXguZHNSb3dzKENGRy5EU19BVFRBQ0hNRU5UU19CWV9RVU9URSwge1xuICAgICAgICAgICAgQXR0YWNobWVudF9Hcm91cF9LZXk6IENGRy5BVFRBQ0hNRU5UX0dST1VQX0tFWSxcbiAgICAgICAgICAgIFJlY29yZF9LZXlfVmFsdWU6IFN0cmluZyhxdW90ZUtleSlcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShyb3dzKSA/IHJvd3MubGVuZ3RoIDogMDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBxdW90ZUhlYWRlckdldChyb3cpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIEN1c3RvbWVyX0NvZGU6IHJvdz8uQ3VzdG9tZXJfQ29kZSA/PyBudWxsLFxuICAgICAgICAgICAgQ3VzdG9tZXJfTmFtZTogcm93Py5DdXN0b21lcl9OYW1lID8/IG51bGwsXG4gICAgICAgICAgICBDdXN0b21lcl9Obzogcm93Py5DdXN0b21lcl9ObyA/PyBudWxsLFxuICAgICAgICAgICAgUXVvdGVfTm86IHJvdz8uUXVvdGVfTm8gPz8gbnVsbFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8vID09PT09IEh1YiBidXR0b24gPT09PT1cbiAgICBjb25zdCBIVUJfQlROX0lEID0gJ3F0MzUtYXR0YWNobWVudHMtYnRuJztcblxuICAgIGFzeW5jIGZ1bmN0aW9uIHNldEJhZGdlQ291bnQobikge1xuICAgICAgICBjb25zdCBjb3VudCA9IE51bWJlcihuID8/IDApO1xuICAgICAgICBjb25zdCBodWIgPSBhd2FpdCBsdC5jb3JlLnF0LmdldEh1Yih7IG1vdW50OiBcIm5hdlwiIH0pO1xuICAgICAgICBpZiAoIWh1Yj8ucmVnaXN0ZXJCdXR0b24pIHJldHVybjtcblxuICAgICAgICAvLyBJZiBodWIgc3VwcG9ydHMgdXBkYXRlQnV0dG9uLCB1c2UgaXQ7IG90aGVyd2lzZSBtaW5pbWFsIGNodXJuXG4gICAgICAgIGNvbnN0IGxhYmVsID0gYEF0dGFjaG1lbnRzICgke2NvdW50fSlgO1xuICAgICAgICBpZiAodHlwZW9mIGh1Yi51cGRhdGVCdXR0b24gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGh1Yi51cGRhdGVCdXR0b24oSFVCX0JUTl9JRCwgeyBsYWJlbCB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZhbGxiYWNrOiBvbmx5IHJlLXJlZ2lzdGVyIGlmIG5vdCBwcmVzZW50IChhdm9pZCByZW1vdmUvcmUtYWRkIGNodXJuKVxuICAgICAgICBjb25zdCBsaXN0ID0gaHViLmxpc3Q/LigpO1xuICAgICAgICBjb25zdCBhbHJlYWR5ID0gQXJyYXkuaXNBcnJheShsaXN0KSAmJiBsaXN0LmluY2x1ZGVzKEhVQl9CVE5fSUQpO1xuICAgICAgICBpZiAoIWFscmVhZHkpIHtcbiAgICAgICAgICAgIGh1Yi5yZWdpc3RlckJ1dHRvbignbGVmdCcsIHtcbiAgICAgICAgICAgICAgICBpZDogSFVCX0JUTl9JRCxcbiAgICAgICAgICAgICAgICBsYWJlbCxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ1JlZnJlc2ggYXR0YWNobWVudHMgKG1hbnVhbCknLFxuICAgICAgICAgICAgICAgIHdlaWdodDogMTIwLFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHJ1bk9uZVJlZnJlc2godHJ1ZSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTm8gdXBkYXRlIEFQSTsgZG8gYSBnZW50bGUgcmVwbGFjZVxuICAgICAgICAgICAgaHViLnJlbW92ZT8uKEhVQl9CVE5fSUQpO1xuICAgICAgICAgICAgaHViLnJlZ2lzdGVyQnV0dG9uKCdsZWZ0Jywge1xuICAgICAgICAgICAgICAgIGlkOiBIVUJfQlROX0lELFxuICAgICAgICAgICAgICAgIGxhYmVsOiBgQXR0YWNobWVudHMgJHtjb3VudH1gLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnUmVmcmVzaCBhdHRhY2htZW50cyAobWFudWFsKScsXG4gICAgICAgICAgICAgICAgd2VpZ2h0OiAxMjAsXG4gICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gcnVuT25lUmVmcmVzaCh0cnVlKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgcmVmcmVzaEluRmxpZ2h0ID0gZmFsc2U7XG4gICAgYXN5bmMgZnVuY3Rpb24gcnVuT25lUmVmcmVzaChtYW51YWwgPSBmYWxzZSkge1xuICAgICAgICBhd2FpdCBsdC5jb3JlLnF0LmVuc3VyZUh1YkJ1dHRvbih7XG4gICAgICAgICAgICBpZDogSFVCX0JUTl9JRCxcbiAgICAgICAgICAgIGxhYmVsOiAnQXR0YWNobWVudHMgKDApJyxcbiAgICAgICAgICAgIHRpdGxlOiAnUmVmcmVzaCBhdHRhY2htZW50cyAobWFudWFsKScsXG4gICAgICAgICAgICBzaWRlOiAnbGVmdCcsXG4gICAgICAgICAgICB3ZWlnaHQ6IDEyMCxcbiAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHJ1bk9uZVJlZnJlc2godHJ1ZSksXG4gICAgICAgICAgICBzaG93V2hlbjogKGN0eCkgPT5cbiAgICAgICAgICAgICAgICAodHlwZW9mIEZPUkNFX1NIT1dfQlROICE9PSAndW5kZWZpbmVkJyAmJiBGT1JDRV9TSE9XX0JUTikgfHxcbiAgICAgICAgICAgICAgICBDRkcuU0hPV19PTl9QQUdFU19SRS50ZXN0KGN0eC5wYWdlTmFtZSkgfHxcbiAgICAgICAgICAgICAgICBjdHguaXNPblBhcnRTdW1tYXJ5LFxuICAgICAgICAgICAgbW91bnQ6ICduYXYnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChyZWZyZXNoSW5GbGlnaHQpIHJldHVybjtcbiAgICAgICAgcmVmcmVzaEluRmxpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgdCA9IGx0LmNvcmUuaHViLmJlZ2luVGFzayhcIkZldGNoaW5nIEF0dGFjaG1lbnRzXHUyMDI2XCIsIFwiaW5mb1wiKTtcblxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBlbnN1cmVXaXphcmRWTSgpO1xuICAgICAgICAgICAgY29uc3QgY3R4ID0gbHQ/LmNvcmU/LnF0Py5nZXRRdW90ZUNvbnRleHQ/LigpO1xuICAgICAgICAgICAgY29uc3QgcWsgPSBOdW1iZXIoY3R4Py5xdW90ZUtleSk7XG5cbiAgICAgICAgICAgIGlmICghcWsgfHwgIU51bWJlci5pc0Zpbml0ZShxaykgfHwgcWsgPD0gMCkge1xuICAgICAgICAgICAgICAgIHNldEJhZGdlQ291bnQoMCk7XG4gICAgICAgICAgICAgICAgdC5lcnJvcihgXHUyNkEwXHVGRTBGIFF1b3RlIEtleSBub3QgZm91bmRgLCA0MDAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElmIHNjb3BlIGNoYW5nZWQsIHBhaW50IGFueSBleGlzdGluZyBzbmFwc2hvdCBiZWZvcmUgZmV0Y2hpbmdcbiAgICAgICAgICAgIGlmICghcXVvdGVSZXBvIHx8IGxhc3RTY29wZSAhPT0gcWspIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBlbnN1cmVSZXBvRm9yUXVvdGUocWspO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlYWQgPSBhd2FpdCBxdW90ZVJlcG8/LmdldEhlYWRlcj8uKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChoZWFkPy5BdHRhY2htZW50X0NvdW50ICE9IG51bGwpIHNldEJhZGdlQ291bnQoTnVtYmVyKGhlYWQuQXR0YWNobWVudF9Db3VudCkpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggeyB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFByb21vdGUgb25seSBpZiBhIHJlYWwgZHJhZnQgZXhpc3RzOyBvdGhlcndpc2Ugc2tpcCBmYXN0XG4gICAgICAgICAgICBhd2FpdCBwcm9tb3RlRHJhZnRJZlByZXNlbnRPbmNlKHFrKTtcblxuICAgICAgICAgICAgLy8gQWZ0ZXIgcHJvbW90aW9uLCAocmUpZW5zdXJlIHRoZSBwZXItcXVvdGUgcmVwbyB3aXRoIGJvdW5kZWQgcmV0cmllc1xuICAgICAgICAgICAgYXdhaXQgZW5zdXJlUmVwb1JlYWR5KHFrLCA2LCAyNTApO1xuXG4gICAgICAgICAgICBpZiAoIXF1b3RlUmVwbykge1xuICAgICAgICAgICAgICAgIC8vIE5vIGVuZGxlc3Mgc3Bpbm5lcjsgZmFpbCBmYXN0LCB1c2VyIGNhbiBjbGljayBhZ2FpbiBvciBpdCB3aWxsIHdvcmsgbmV4dCBmaXJlXG4gICAgICAgICAgICAgICAgdC5lcnJvcignRGF0YSBjb250ZXh0IHdhcm1pbmcgXHUyMDE0IHRyeSBhZ2FpbiBpbiBhIG1vbWVudCcsIDI1MDApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgY291bnQgPSBhd2FpdCBmZXRjaEF0dGFjaG1lbnRDb3VudChxayk7XG4gICAgICAgICAgICBzZXRCYWRnZUNvdW50KGNvdW50KTtcbiAgICAgICAgICAgIGF3YWl0IHF1b3RlUmVwby5wYXRjaEhlYWRlcih7IFF1b3RlX0tleTogcWssIEF0dGFjaG1lbnRfQ291bnQ6IE51bWJlcihjb3VudCkgfSk7XG5cbiAgICAgICAgICAgIC8vIEFsd2F5cyByZXNvbHZlIHRoZSB0YXNrXG4gICAgICAgICAgICBjb25zdCBvayA9IGNvdW50ID4gMDtcbiAgICAgICAgICAgIHQuc3VjY2VzcyhvayA/IGBcdTI3MDUgJHtjb3VudH0gYXR0YWNobWVudChzKWAgOiAnTm8gYXR0YWNobWVudHMnLCAyMDAwKTtcblxuICAgICAgICAgICAgLy8gT3B0aW9uYWwgdG9hc3Qgd2hlbiB1c2VyIGNsaWNrZWQgbWFudWFsbHlcbiAgICAgICAgICAgIGlmIChtYW51YWwpIHtcbiAgICAgICAgICAgICAgICBsdC5jb3JlLmh1Yi5ub3RpZnkoXG4gICAgICAgICAgICAgICAgICAgIG9rID8gYFx1MjcwNSAke2NvdW50fSBhdHRhY2htZW50KHMpYCA6ICdObyBhdHRhY2htZW50cycsXG4gICAgICAgICAgICAgICAgICAgIG9rID8gJ3N1Y2Nlc3MnIDogJ3dhcm4nLFxuICAgICAgICAgICAgICAgICAgICB7IHRpbWVvdXQ6IDIwMDAsIHRvYXN0OiB0cnVlIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGxvZygncmVmcmVzaCcsIHsgcWssIGNvdW50IH0pO1xuXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZGVycigncmVmcmVzaCBmYWlsZWQnLCBlcnIpO1xuICAgICAgICAgICAgdC5lcnJvcihgXHUyNzRDIEF0dGFjaG1lbnRzIHJlZnJlc2ggZmFpbGVkOiAke2Vycj8ubWVzc2FnZSB8fCBlcnJ9YCwgNDAwMCk7XG4gICAgICAgICAgICBsdC5jb3JlLmh1Yi5ub3RpZnkoXG4gICAgICAgICAgICAgICAgYFx1Mjc0QyBBdHRhY2htZW50cyByZWZyZXNoIGZhaWxlZDogJHtlcnI/Lm1lc3NhZ2UgfHwgZXJyfWAsXG4gICAgICAgICAgICAgICAgJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICB7IHRpbWVvdXQ6IDQwMDAsIHRvYXN0OiB0cnVlIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICByZWZyZXNoSW5GbGlnaHQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIExpc3RlbiBmb3IgbW9kYWwtY2xvc2UgcmVmcmVzaCByZXF1ZXN0cyBmcm9tIFFUMjBcbiAgICBsZXQgX19xdDM1X2F1dG9SZWZyZXNoVGltZXIgPSBudWxsO1xuICAgIGZ1bmN0aW9uIG9uQXR0YWNobWVudFJlZnJlc2hSZXF1ZXN0ZWQoZXYpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIE9ubHkgcmVmcmVzaCBvbiBQYXJ0IFN1bW1hcnlcbiAgICAgICAgICAgIGNvbnN0IGN0eCA9IGx0Py5jb3JlPy5xdD8uZ2V0UXVvdGVDb250ZXh0Py4oKTtcbiAgICAgICAgICAgIGNvbnN0IG9uUGFydFN1bW1hcnkgPSAhIShjdHggJiYgKGN0eC5pc09uUGFydFN1bW1hcnkgfHwgQ0ZHLlNIT1dfT05fUEFHRVNfUkUudGVzdChjdHgucGFnZU5hbWUgfHwgJycpKSk7XG4gICAgICAgICAgICBpZiAoIW9uUGFydFN1bW1hcnkpIHJldHVybjtcblxuICAgICAgICAgICAgLy8gRGVib3VuY2UgcmFwaWQgZHVwbGljYXRlIGZpcmVzXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoX19xdDM1X2F1dG9SZWZyZXNoVGltZXIpO1xuICAgICAgICAgICAgX19xdDM1X2F1dG9SZWZyZXNoVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsgcnVuT25lUmVmcmVzaChmYWxzZSk7IH0sIDM1MCk7XG4gICAgICAgIH0gY2F0Y2ggeyAvKiBuby1vcCAqLyB9XG4gICAgfVxuXG4gICAgLy8gPT09PT0gU1BBIHdpcmluZyA9PT09PVxuXG4gICAgbGV0IGJvb3RlZCA9IGZhbHNlOyBsZXQgb2ZmVXJsID0gbnVsbDtcbiAgICBmdW5jdGlvbiB3aXJlTmF2KGhhbmRsZXIpIHsgb2ZmVXJsPy4oKTsgb2ZmVXJsID0gd2luZG93LlRNVXRpbHM/Lm9uVXJsQ2hhbmdlPy4oaGFuZGxlcik7IH1cblxuICAgIGFzeW5jIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIGlmIChib290ZWQpIHJldHVybjtcbiAgICAgICAgYm9vdGVkID0gdHJ1ZTtcblxuICAgICAgICAvLyBBdXRvLXJlZnJlc2ggd2hlbiBRVDIwXHUyMDE5cyBtb2RhbCBjbG9zZXNcbiAgICAgICAgdHJ5IHsgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0xUOkF0dGFjaG1lbnRSZWZyZXNoUmVxdWVzdGVkJywgb25BdHRhY2htZW50UmVmcmVzaFJlcXVlc3RlZCwgZmFsc2UpOyB9IGNhdGNoIHsgfVxuXG4gICAgICAgIGF3YWl0IGx0LmNvcmUucXQuZW5zdXJlSHViQnV0dG9uKHtcbiAgICAgICAgICAgIGlkOiAncXQzNS1hdHRhY2htZW50cy1idG4nLFxuICAgICAgICAgICAgbGFiZWw6ICdBdHRhY2htZW50cyAoMCknLFxuICAgICAgICAgICAgdGl0bGU6ICdSZWZyZXNoIGF0dGFjaG1lbnRzIChtYW51YWwpJyxcbiAgICAgICAgICAgIHNpZGU6ICdsZWZ0JyxcbiAgICAgICAgICAgIHdlaWdodDogMTIwLFxuICAgICAgICAgICAgb25DbGljazogKCkgPT4gcnVuT25lUmVmcmVzaCh0cnVlKSxcbiAgICAgICAgICAgIHNob3dXaGVuOiAoY3R4KSA9PiAodHlwZW9mIEZPUkNFX1NIT1dfQlROICE9PSAndW5kZWZpbmVkJyAmJiBGT1JDRV9TSE9XX0JUTikgfHwgQ0ZHLlNIT1dfT05fUEFHRVNfUkUudGVzdChjdHgucGFnZU5hbWUpIHx8IGN0eC5pc09uUGFydFN1bW1hcnksXG4gICAgICAgICAgICBtb3VudDogJ25hdidcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHRlYXJkb3duKCkge1xuICAgICAgICBib290ZWQgPSBmYWxzZTtcbiAgICAgICAgb2ZmVXJsPy4oKTtcbiAgICAgICAgb2ZmVXJsID0gbnVsbDtcbiAgICAgICAgc3RvcFByb21vdGUoKTsgLy8gZW5zdXJlIGJhY2tncm91bmQgdGltZXIgaXMgY2xlYXJlZFxuICAgICAgICB0cnkgeyB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignTFQ6QXR0YWNobWVudFJlZnJlc2hSZXF1ZXN0ZWQnLCBvbkF0dGFjaG1lbnRSZWZyZXNoUmVxdWVzdGVkLCBmYWxzZSk7IH0gY2F0Y2ggeyB9XG4gICAgICAgIC8vIEh1YiB2aXNpYmlsaXR5IGlzIGhhbmRsZWQgY2VudHJhbGx5IHZpYSBlbnN1cmVIdWJCdXR0b24oKVxuICAgIH1cblxuICAgIGluaXQoKTtcblxuICAgIHdpcmVOYXYoKCkgPT4geyBpZiAoUk9VVEVTLnNvbWUocnggPT4gcngudGVzdChsb2NhdGlvbi5wYXRobmFtZSkpKSBpbml0KCk7IGVsc2UgdGVhcmRvd24oKTsgfSk7XG59KSgpO1xuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLEdBQUMsTUFBTTtBQUNIO0FBRUEsVUFBTSxNQUFPLE9BQXdDLE9BQWdCO0FBQ3JFLFVBQU0sT0FBTyxJQUFJLE1BQU0sT0FBTyxRQUFRLE1BQU0sUUFBUSxHQUFHLENBQUM7QUFDeEQsVUFBTSxPQUFPLElBQUksTUFBTSxRQUFRLE1BQU0scUJBQVcsR0FBRyxDQUFDO0FBQ3BELFVBQU0sT0FBUSxPQUFPLGlCQUFpQixjQUFjLGVBQWU7QUFJbkUsVUFBTSxnQkFBZ0IsQ0FBQyxPQUFPO0FBQzFCLFlBQU0sT0FBTyxJQUFJLE1BQU0sTUFBTTtBQUM3QixhQUFRLE9BQU8sU0FBUyxhQUFjLEtBQUssRUFBRSxJQUFJLEdBQUc7QUFBQSxJQUN4RDtBQUVBLEtBQUMsWUFBWTtBQUVULFlBQU0sT0FBTyxNQUFNLE9BQU8sZUFBZTtBQUN6QyxZQUFNLFNBQVM7QUFBQSxRQUNYLElBQUk7QUFBQSxRQUNKLE9BQU87QUFBQSxRQUNQLE9BQU87QUFBQSxRQUNQLFFBQVE7QUFB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
