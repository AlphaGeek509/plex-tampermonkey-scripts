(()=>{(()=>{let r=typeof unsafeWindow<"u"?unsafeWindow:window,p=r.lt=r.lt||{},u=p.core=p.core||{};u.auth=u.auth||{async getKey(){try{if(r.PlexAuth?.getKey)return await r.PlexAuth.getKey();if(r.PlexAPI?.getKey)return await r.PlexAPI.getKey()}catch{}return null},async withFreshAuth(i){let s=await u.auth.getKey();if(!s)try{r.PlexAuth?.refresh?(await r.PlexAuth.refresh(),s=await u.auth.getKey()):r.PlexAPI?.refresh&&(await r.PlexAPI.refresh(),s=await u.auth.getKey())}catch{}return i(s||void 0)}},u.http=u.http||{async fetch(i,{method:s="GET",headers:a={},body:l,timeoutMs:h=15e3,useXHR:f=!1}={}){if(r.TMUtils?.fetchData)return await r.TMUtils.fetchData(i,{method:s,headers:a,body:l,timeoutMs:h,useXHR:f});let t=await u.auth.getKey(),n=new Headers(a||{});t&&!n.has("Authorization")&&n.set("Authorization",`Bearer ${t}`),l&&!n.has("Content-Type")&&n.set("Content-Type","application/json");let e=new AbortController,o=setTimeout(()=>e.abort(),h);try{let c=await fetch(i,{method:s,headers:n,body:l&&typeof l!="string"?JSON.stringify(l):l,signal:e.signal,credentials:"include"}),d=(c.headers.get("content-type")||"").includes("application/json")?await c.json():await c.text();if(!c.ok)throw new Error(`HTTP ${c.status} ${c.statusText}`);return d}finally{clearTimeout(o)}},async get(i,s={}){return this.fetch(i,{...s||{},method:"GET"})},async post(i,s,a={}){return this.fetch(i,{...a||{},method:"POST",body:s})}},u.plex=u.plex||{async ds(i,s={},a={}){if(r.TMUtils?.ds)return await r.TMUtils.ds(i,s,a);let h=`${location.origin.replace(/\/$/,"")}/api/datasources/${i}/execute?format=2`,f=await u.http.post(h,s,a),t=Array.isArray(f?.rows)?f.rows:[];return{...f,rows:t}},async dsRows(i,s={},a={}){if(r.TMUtils?.dsRows)return await r.TMUtils.dsRows(i,s,a);let{rows:l}=await this.ds(i,s,a);return l}},u.hub=u.hub||(()=>{let i=(()=>{let t={};t._sticky=!1;function n(){let e=document.querySelector("#lt-hub-pill");return e||(e=document.createElement("div"),e.id="lt-hub-pill",e.style.cssText=`
                        position: fixed;
                        top: 10px; right: 10px;
                        z-index: 2147483000;
                        background: rgba(0,0,0,.8);
                        color: #fff;
                        font: 13px system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
                        padding: 6px 10px; border-radius: 999px;
                        box-shadow: 0 8px 24px rgba(0,0,0,0.25);
                    `,e.textContent="\u2026",document.documentElement.appendChild(e)),e}return t.setStatus=(e,o="info",{sticky:c=!1}={})=>{let y=n();return y.textContent=e||"",t._sticky=!!c,t._sticky||setTimeout(()=>{try{y.remove()}catch{}},2e3),t},t.notify=(e,o,{ms:c=2500}={})=>{let y=n();return y.textContent=o||"",setTimeout(()=>{try{y.remove()}catch{}},Math.max(500,c|0)),t},t.toast=(e,o=3e3)=>t.notify("info",e,{ms:o}),t})(),s=!1,a=null,l=[];async function h(){return s?!0:a||(a=(async()=>{try{let t=typeof ensureLTHub=="function"?ensureLTHub:typeof r.ensureLTHub=="function"?r.ensureLTHub:null;return t&&await t({theme:{name:"OneMonroe"},mount:r.__LT_HUB_MOUNT||"nav",pageRootSelectors:["#plexSidetabsMenuPage",".plex-sidetabs-menu-page",".plex-sidetabs-menu-page-content",".plex-sidetabs-menu-page-content-container",".plex-actions-wrapper"],stick:!1,gap:8}),s=!!(typeof ltUIHub<"u"?ltUIHub:r.ltUIHub),s}catch{return s=!1,!1}finally{let t=s?r.ltUIHub:null;for(let{fn:n,args:e}of l.splice(0))try{t&&typeof t[n]=="function"?t[n](...e):i[n](...e)}catch{}}})(),a)}function f(t,...n){let e=s?typeof ltUIHub<"u"?ltUIHub:r.ltUIHub:null;if(e&&typeof e[t]=="function"){try{e[t](...n)}catch{}return}if(typeof ensureLTHub=="function"||typeof r.ensureLTHub=="function"){l.push({fn:t,args:n}),h();return}i[t](...n)}return{setStatus(t,n="info",e={}){return f("setStatus",t,n,e),this},notify(t,n="info",e={}){let o=e?.timeout??e?.ms??2500;return f("notify",n,t,{ms:o,sticky:!!e?.sticky,toast:!!e?.toast}),!s&&typeof r.ensureLTHub!="function"&&i.notify(t,n,e),this},toast(t,n=3e3){return f("notify","info",t,{ms:n,toast:!0}),!s&&typeof r.ensureLTHub!="function"&&i.toast(t,n),this},updateButton(t,n={}){return f("updateButton",t,n),this},beginTask(t,n="info"){if(s&&r.ltUIHub?.beginTask)return r.ltUIHub.beginTask(t,n);this.setStatus(t,n,{sticky:!0});let e={update:(o,c=n)=>(this.setStatus(o,c,{sticky:!0}),e),success:(o="Done",c=2500)=>(this.setStatus("","info",{sticky:!1}),this.notify(o,"success",{timeout:c}),e),error:(o="Failed")=>(this.setStatus("","info",{sticky:!1}),this.notify(o,"error",{timeout:3500}),e),clear:()=>(this.setStatus("","info",{sticky:!1}),e),done:(o,c)=>e.success(o,c)};return h().then(()=>{let o=typeof ltUIHub<"u"?ltUIHub:r.ltUIHub;if(o?.beginTask)try{o.beginTask(t,n)}catch{}}),e}}})(),u.theme=u.theme||{apply(){try{let i=typeof GM_getResourceText=="function"?GM_getResourceText("THEME_CSS"):"";i&&typeof GM_addStyle=="function"&&GM_addStyle(i)}catch(i){try{console.warn("[lt-core] theme.apply failed",i)}catch{}}}},u.util=u.util||{sleep(i){return new Promise(s=>setTimeout(s,Math.max(0,i|0)))},once(i,s){let a=u.__once=u.__once||new Set;if(!a.has(i))return a.add(i),s()}};try{u.theme.apply()}catch{}try{console.debug?.("[lt-core] ready")}catch{}})();})();
;(function(g){try{if(typeof LTCore!=='undefined'){g.LTCore=LTCore;}}catch(e){}})(typeof unsafeWindow!=='undefined'?unsafeWindow:window);
