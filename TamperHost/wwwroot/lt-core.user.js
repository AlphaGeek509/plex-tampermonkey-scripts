(()=>{(()=>{let i=typeof unsafeWindow<"u"?unsafeWindow:window,Q=i.lt=i.lt||{},l=Q.core=Q.core||{};l.auth=l.auth||{async getKey(){try{if(i.PlexAuth?.getKey)return await i.PlexAuth.getKey();if(i.PlexAPI?.getKey)return await i.PlexAPI.getKey()}catch{}return null},async withFreshAuth(a){let u=await l.auth.getKey();if(!u)try{i.PlexAuth?.refresh?(await i.PlexAuth.refresh(),u=await l.auth.getKey()):i.PlexAPI?.refresh&&(await i.PlexAPI.refresh(),u=await l.auth.getKey())}catch{}return a(u||void 0)}},l.http=l.http||{async fetch(a,{method:u="GET",headers:c={},body:p,timeoutMs:x=15e3,useXHR:w=!1}={}){if(i.TMUtils?.fetchData)return await i.TMUtils.fetchData(a,{method:u,headers:c,body:p,timeoutMs:x,useXHR:w});let e=await l.auth.getKey(),r=new Headers(c||{});e&&!r.has("Authorization")&&r.set("Authorization",`Bearer ${e}`),p&&!r.has("Content-Type")&&r.set("Content-Type","application/json");let o=new AbortController,y=setTimeout(()=>o.abort(),x);try{let d=await fetch(a,{method:u,headers:r,body:p&&typeof p!="string"?JSON.stringify(p):p,signal:o.signal,credentials:"include"}),k=(d.headers.get("content-type")||"").includes("application/json")?await d.json():await d.text();if(!d.ok)throw new Error(`HTTP ${d.status} ${d.statusText}`);return k}finally{clearTimeout(y)}},async get(a,u={}){return this.fetch(a,{...u||{},method:"GET"})},async post(a,u,c={}){return this.fetch(a,{...c||{},method:"POST",body:u})}},l.plex=l.plex||{async ds(a,u={},c={}){if(i.TMUtils?.ds)return await i.TMUtils.ds(a,u,c);let x=`${location.origin.replace(/\/$/,"")}/api/datasources/${a}/execute?format=2`,w=await l.http.post(x,u,c),e=Array.isArray(w?.rows)?w.rows:[];return{...w,rows:e}},async dsRows(a,u={},c={}){if(i.TMUtils?.dsRows)return await i.TMUtils.dsRows(a,u,c);let{rows:p}=await this.ds(a,u,c);return p}},l.hub=l.hub||(()=>{let a=(()=>{let e={};e._sticky=!1;function r(){let o=document.querySelector("#lt-hub-pill");return o||(o=document.createElement("div"),o.id="lt-hub-pill",o.style.cssText=`
                        position: fixed;
                        top: 10px; right: 10px;
                        z-index: 2147483000;
                        background: rgba(0,0,0,.8);
                        color: #fff;
                        font: 13px system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
                        padding: 6px 10px; border-radius: 999px;
                        box-shadow: 0 8px 24px rgba(0,0,0,0.25);
                    `,o.textContent="\u2026",document.documentElement.appendChild(o)),o}return e.setStatus=(o,y="info",{sticky:d=!1}={})=>{let U=r();return U.textContent=o||"",e._sticky=!!d,e._sticky||setTimeout(()=>{try{U.remove()}catch{}},2e3),e},e.notify=(o,y,{ms:d=5e3}={})=>{let U=r();return U.textContent=y||"",setTimeout(()=>{try{U.remove()}catch{}},Math.max(500,d|0)),e},e.toast=(o,y=5e3)=>e.notify("info",o,{ms:y}),e})(),u=!1,c=null,p=[];async function x(){return u?!0:c||(c=(async()=>{try{let e=typeof ensureLTHub=="function"?ensureLTHub:typeof i.ensureLTHub=="function"?i.ensureLTHub:null;return e&&await e({theme:{name:"OneMonroe"},mount:i.__LT_HUB_MOUNT||"nav",pageRootSelectors:["#plexSidetabsMenuPage",".plex-sidetabs-menu-page",".plex-sidetabs-menu-page-content",".plex-sidetabs-menu-page-content-container",".plex-actions-wrapper"],stick:!1,gap:8}),u=!!(typeof ltUIHub<"u"?ltUIHub:i.ltUIHub),u}catch{return u=!1,!1}finally{let e=u?i.ltUIHub:null;for(let{fn:r,args:o}of p.splice(0))try{e&&typeof e[r]=="function"?e[r](...o):a[r](...o)}catch{}}})(),c)}function w(e,...r){let o=u?typeof ltUIHub<"u"?ltUIHub:i.ltUIHub:null;if(o&&typeof o[e]=="function"){try{o[e](...r)}catch{}return}if(typeof ensureLTHub=="function"||typeof i.ensureLTHub=="function"){p.push({fn:e,args:r}),x();return}a[e](...r)}return{setStatus(e,r="info",o={}){return w("setStatus",e,r,o),this},notify(e,r="info",o={}){let y=o?.timeout??o?.ms??5e3;return w("notify",r,e,{ms:y,sticky:!!o?.sticky,toast:!!o?.toast}),!u&&typeof i.ensureLTHub!="function"&&a.notify(e,r,o),this},toast(e,r=5e3){return w("notify","info",e,{ms:r,toast:!0}),!u&&typeof i.ensureLTHub!="function"&&a.toast(e,r),this},updateButton(e,r={}){return w("updateButton",e,r),this},beginTask(e,r="info"){if(u&&i.ltUIHub?.beginTask)return i.ltUIHub.beginTask(e,r);this.setStatus(e,r,{sticky:!0});let o={update:(y,d=r)=>(this.setStatus(y,d,{sticky:!0}),o),success:(y="Done",d=5e3)=>(this.setStatus("","info",{sticky:!1}),this.notify(y,"success",{timeout:d}),o),error:(y="Failed")=>(this.setStatus("","info",{sticky:!1}),this.notify(y,"error",{timeout:5e3}),o),clear:()=>(this.setStatus("","info",{sticky:!1}),o),done:(y,d)=>o.success(y,d)};return x().then(()=>{let y=typeof ltUIHub<"u"?ltUIHub:i.ltUIHub;if(y?.beginTask)try{y.beginTask(e,r)}catch{}}),o}}})(),l.theme=l.theme||{apply(){try{let a=typeof GM_getResourceText=="function"?GM_getResourceText("THEME_CSS"):"";a&&typeof GM_addStyle=="function"&&GM_addStyle(a)}catch(a){try{console.warn("[lt-core] theme.apply failed",a)}catch{}}}},l.util=l.util||{sleep(a){return new Promise(u=>setTimeout(u,Math.max(0,a|0)))},once(a,u){let c=l.__once=l.__once||new Set;if(!c.has(a))return c.add(a),u()}},l.qt=l.qt||(()=>{let a=typeof unsafeWindow<"u"?unsafeWindow:window;function u(t="QT"){try{if(typeof a.getTabScopeId=="function")return a.getTabScopeId(t)}catch{}try{let n=a.sessionStorage,s=`lt:${t}:__scopeId`,f=n.getItem(s);f||(f=String(Math.floor(Math.random()*2147483647)),n.setItem(s,f));let g=Number(f);if(!Number.isFinite(g)||g<=0)throw new Error("bad scope");return g}catch{let n="__LT_QT_SCOPE_ID__";return a[n]||(a[n]=Math.floor(Math.random()*2147483647)),a[n]}}function c(){let t=a.lt?.core?.data?.makeFlatScopedRepo;return typeof t=="function"?t({ns:"QT",entity:"quote",legacyEntity:"QuoteHeader"}):null}async function p(){let t=c();if(!t)return null;let{repo:n}=t.use(u("QT"));return n||null}async function x(t){let n=c();if(!n||!t||!Number.isFinite(t)||t<=0)return null;let{repo:s}=n.use(Number(t));return s||null}function w(t={},n={}){let s=Number(t.Updated_At??0),f=Number(n?.Updated_At??0),g=String(t.Customer_No??""),h=String(n?.Customer_No??""),S=String(t.Catalog_Key??"")!==String(n?.Catalog_Key??""),H=String(t.Catalog_Code??"")!==String(n?.Catalog_Code??"");return f>s||S||H||g!==h}async function e(t){let n=await p();if(!n)return"no-dc";let s=await n.getHeader?.()||await n.get?.();if(!s||!Object.keys(s).length)try{let{repo:h}=c().use("draft"),S=await h.getHeader?.()||await h.get?.();S&&Object.keys(S).length&&(await n.patchHeader?.(S),s=S)}catch{}if(!s||!Object.keys(s).length)return"no-draft";let f=await x(t);if(!f)return"no-quote";let g=await f.getHeader?.()||{};if(!w(g,s))return"noop";await f.patchHeader?.({...s,Quote_Key:Number(t),Quote_Header_Fetched_At:Date.now(),Promoted_From:"draft",Promoted_At:Date.now()});try{await n.clear?.()}catch{}try{let{repo:h}=c().use("draft");await h.clear?.()}catch{}return"merged"}let r={timer:null,tries:0,max:20,ms:250};function o(){r.timer&&clearInterval(r.timer),r.timer=null,r.tries=0}function y({qk:t,strategy:n="once"}={}){if(n==="retry"){o(),r.timer=setInterval(async()=>{r.tries++,(await e(t)==="merged"||r.tries>=r.max)&&o()},r.ms);return}return e(t)}function d(t){let n=Number(t);return Number.isFinite(n)?n:0}function U(){try{let t=new URL(location.href);return{quoteKey:d(t.searchParams.get("QuoteKey")||t.searchParams.get("quoteKey"))}}catch{return{quoteKey:0}}}function k(){let t=document.querySelector('[data-quote-key],#QuoteKey,[name="QuoteKey"]'),n=t?d(t.getAttribute("data-quote-key")??t.value):0,s=(document.querySelector(".wizard-steps .active, .wizard .active, .plex-sidetabs .active")?.textContent||document.querySelector(".page-title, .content-header h1, .plex-navbar-title")?.textContent||document.querySelector('[aria-current="page"]')?.textContent||"").trim();return{quoteKey:n,pageName:s}}function F(){try{let t=window.ko&&typeof window.ko.dataFor=="function"?window.ko.dataFor(document.body):null,n=d(t?.QuoteKey??t?.quoteKey??t?.Quote?.QuoteKey)||0,s=String(t?.CurrentPageName??t?.currentPageName??t?.Wizard?.CurrentPageName??"").trim();return{quoteKey:n,pageName:s}}catch{return{quoteKey:0,pageName:""}}}function E(){let t=F(),n=k(),s=U(),f=t.quoteKey||n.quoteKey||s.quoteKey||0,g=(t.pageName||n.pageName||document.title||"").replace(/\s+/g," ").trim(),h=(()=>{try{if(!!document.querySelector('#QuotePartSummaryForm,[id^="QuotePartSummaryForm_"]'))return!0;let H=document.querySelector(".plex-wizard-page-list .plex-wizard-page.active");if(H&&H.textContent&&H.textContent.trim().toLowerCase()==="part summary")return!0}catch{}return/part\s*summary/i.test(g)||/part(?:%20|\s|-)?summary|summary(?:%20|\s|-)?part/i.test(location.href)})();return{quoteKey:f,pageName:g,isOnPartSummary:h}}function R(){let{quoteKey:t,pageName:n,isOnPartSummary:s}=E();return{quoteKey:t,pageName:n,isOnPartSummary:s,hasQuoteKey:t>0,isPage:f=>new RegExp(String(f).replace(/\s+/g,"\\s*"),"i").test(n)}}async function A(t={mount:"nav"}){let n=typeof unsafeWindow<"u"?unsafeWindow:window;for(let s=0;s<50;s++){let f=n.ensureLTHub||window.ensureLTHub;if(typeof f=="function")try{await f(t);let h=typeof ltUIHub<"u"?ltUIHub:n.ltUIHub;if(h)return h}catch{}let g=typeof ltUIHub<"u"?ltUIHub:n.ltUIHub;if(g)return g;await new Promise(h=>setTimeout(h,100))}return{__fallback:!0}}async function v({id:t,label:n,title:s,side:f="left",weight:g=120,onClick:h,showWhen:S,force:H=!1,mount:B="nav"}={}){let _=await A({mount:B}),D=!!(_&&!_.__fallback&&typeof _.registerButton=="function"),L=()=>{try{let b=R();return!!(H||(typeof S!="function"||S(b)))}catch{return!!H}};if(D){let b=function(){try{let T=_.list?.();return Array.isArray(T)?T.map(C=>C&&typeof C=="object"?C.id:C).filter(Boolean):[]}catch{return[]}},m=function(){try{return typeof _.has=="function"?!!_.has(t):b().includes(t)}catch{return!1}},M=function(){return m()?!1:q()};var G=b,W=m,J=M;async function q(){let T={id:t,label:n,title:s,weight:g,onClick:h};try{_.registerButton?.(f,T)}catch{}if(await 0,!m())try{_.registerButton?.({...T,section:f})}catch{}if(await 0,!m())try{_.registerButton({...T,section:f})}catch{}if(await 0,!m())try{_.registerButton(f,T)}catch{}return m()}M();async function O(){try{let T=L(),C=m();return T?(C||M(),!0):(C&&_.remove?.(t),!1)}catch{return!1}}v.__state=v.__state||{};let P=v.__state[t]||={obs:null,offUrl:null};if(await O(),!P.obs){let T=document.querySelector(".plex-wizard-page-list")||document.body;T&&window.MutationObserver&&(P.obs=new MutationObserver(()=>{O()}),P.obs.observe(T,{subtree:!0,attributes:!0,childList:!0}))}return!P.offUrl&&window.TMUtils?.onUrlChange&&(P.offUrl=window.TMUtils.onUrlChange(()=>{O()})),!0}let K=`lt-navbtn-${t}`;function j(){return document.querySelector("#navBar .navbar-right")||document.querySelector(".plex-navbar-container .navbar-right")||document.querySelector(".navbar-right")||document.getElementById("navBar")||document.body}function z(){let b=j();if(!b)return null;let m=document.getElementById(K);return m||(m=document.createElement("button"),m.id=K,m.type="button",m.className="btn btn-primary",m.title=s||"",m.textContent=n||t,m.style.marginLeft="8px",m.addEventListener("click",q=>{try{h?.(q)}catch{}}),b.appendChild(m)),m}function $(){let b=document.getElementById(K);if(b)try{b.remove()}catch{}}async function N(){L()?z():$()}v.__state=v.__state||{};let I=v.__state[t]||={obs:null,offUrl:null};if(await N(),!I.obs){let b=document.querySelector(".plex-wizard-page-list")||document.body;b&&window.MutationObserver&&(I.obs=new MutationObserver(()=>{N()}),I.obs.observe(b,{subtree:!0,attributes:!0,childList:!0}))}return!I.offUrl&&window.TMUtils?.onUrlChange&&(I.offUrl=window.TMUtils.onUrlChange(()=>{N()})),!0}return{promoteDraftToQuote:y,stopRetry:o,useDraftRepo:p,useQuoteRepo:x,getQuoteContext:R,getHub:A,ensureHubButton:v}})();try{l.theme.apply()}catch{}})();})();
;(function(g){try{if(typeof LTCore!=='undefined'){g.LTCore=LTCore;}}catch(e){}})(typeof unsafeWindow!=='undefined'?unsafeWindow:window);
